<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS Professional - Toko Maju Jaya</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563EB',
                        success: '#10B981',
                        background: '#F8FAFC'
                    },
                    fontFamily: {
                        'montserrat': ['Montserrat', 'sans-serif'],
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-background font-inter">
    <!-- Sidebar -->
    <div class="fixed left-0 top-0 h-full w-64 bg-white shadow-lg z-50">
        <div class="p-6 border-b">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                    <span class="text-white font-bold text-lg">TM</span>
                </div>
                <div>
                    <h1 class="font-montserrat font-bold text-lg text-gray-800">Toko Maju Jaya</h1>
                    <p class="text-xs text-gray-500">Point of Sale System</p>
                </div>
            </div>
        </div>
        
        <nav class="p-4">
            <ul class="space-y-2">
                <li><button onclick="showSection('dashboard')" class="nav-btn w-full text-left px-4 py-3 rounded-lg bg-primary text-white font-semibold">üìä Dashboard</button></li>
                <li><button onclick="showSection('products')" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-semibold">üì¶ Produk</button></li>
                <li><button onclick="showSection('transaction')" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-semibold">üõí Transaksi</button></li>
                <li><button onclick="showSection('reports')" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-semibold">üìà Laporan</button></li>
                <li><button onclick="showSection('customers')" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-semibold">üë• Pelanggan</button></li>
                <li><button onclick="showSection('backup')" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-semibold">üíæ Backup Data</button></li>
                <li><button onclick="showSection('settings')" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-semibold">‚öôÔ∏è Pengaturan</button></li>
            </ul>
        </nav>

        <!-- Keyboard Shortcuts Info -->
        <div class="absolute bottom-4 left-4 right-4">
            <button onclick="showKeyboardShortcuts()" class="w-full bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">
                ‚å®Ô∏è Keyboard Shortcuts
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="ml-64 min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b px-8 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h2 id="page-title" class="text-2xl font-montserrat font-bold text-gray-800">Dashboard</h2>
                    <p class="text-gray-600" id="current-time"></p>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Low Stock Alert -->
                    <div class="relative" id="low-stock-alert" style="display: none;">
                        <button onclick="showLowStockAlert()" class="w-10 h-10 bg-red-500 rounded-full flex items-center justify-center text-white animate-pulse">
                            ‚ö†Ô∏è
                        </button>
                        <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-600 rounded-full text-white text-xs flex items-center justify-center" id="low-stock-count">0</span>
                    </div>
                    <div class="relative">
                        <button class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white">
                            üîî
                        </button>
                        <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-white text-xs flex items-center justify-center">3</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gray-300 rounded-full"></div>
                        <span class="font-semibold text-gray-700">Admin</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="p-8">
            <!-- Low Stock Warning -->
            <div id="dashboard-low-stock-warning" class="mb-6" style="display: none;">
                <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded-lg">
                    <div class="flex items-center">
                        <div class="text-red-400 text-xl mr-3">‚ö†Ô∏è</div>
                        <div>
                            <h3 class="text-red-800 font-semibold">Peringatan Stok Rendah!</h3>
                            <p class="text-red-700 text-sm">Beberapa produk memiliki stok ‚â§ 10 unit. Segera lakukan restok.</p>
                            <button onclick="showSection('products')" class="mt-2 bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors">
                                Lihat Produk
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Daily Stats -->
                <div class="bg-gradient-to-r from-primary to-blue-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm">Penjualan Hari Ini</p>
                            <p class="text-2xl font-bold" id="daily-sales">Rp 0</p>
                            <p class="text-blue-200 text-xs mt-1" id="daily-transactions">0 transaksi</p>
                        </div>
                        <div class="text-4xl opacity-80">üí∞</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-success to-green-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm">Keuntungan Hari Ini</p>
                            <p class="text-2xl font-bold" id="daily-profit">Rp 0</p>
                            <p class="text-green-200 text-xs mt-1" id="daily-margin">0% margin</p>
                        </div>
                        <div class="text-4xl opacity-80">üíé</div>
                    </div>
                </div>
                
                <!-- Monthly Stats -->
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-100 text-sm">Penjualan Bulan Ini</p>
                            <p class="text-2xl font-bold" id="monthly-sales">Rp 0</p>
                            <p class="text-orange-200 text-xs mt-1" id="monthly-transactions">0 transaksi</p>
                        </div>
                        <div class="text-4xl opacity-80">üìä</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm">Keuntungan Bulan Ini</p>
                            <p class="text-2xl font-bold" id="monthly-profit">Rp 0</p>
                            <p class="text-purple-200 text-xs mt-1" id="monthly-margin">0% margin</p>
                        </div>
                        <div class="text-4xl opacity-80">üèÜ</div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Tren Penjualan 7 Hari</h3>
                    <canvas id="salesChart" width="400" height="200"></canvas>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Kategori Produk Terlaris</h3>
                    <canvas id="categoryChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Transaksi Terbaru</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Invoice</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Waktu</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Items</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Total</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                            </tr>
                        </thead>
                        <tbody id="recent-transactions">
                            <tr>
                                <td colspan="5" class="text-center py-8 text-gray-500">Belum ada transaksi hari ini</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Products Section -->
        <div id="products-section" class="p-8 hidden">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-xl font-montserrat font-bold text-gray-800">Manajemen Produk</h3>
                    <p class="text-gray-600">Kelola inventori dan harga produk</p>
                </div>
                <div class="flex space-x-3">
                    <button onclick="downloadCSVTemplate()" class="bg-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                        üìã Template CSV
                    </button>
                    <button onclick="importCSV()" class="bg-purple-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-600 transition-colors">
                        üìä Import CSV
                    </button>
                    <button onclick="showAddProductModal()" class="bg-success text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        ‚ûï Tambah Produk
                    </button>
                </div>
            </div>

            <!-- Search and Filter -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex flex-wrap gap-4">
                    <input type="text" id="product-search" placeholder="Cari produk..." class="flex-1 min-w-64 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                    <select id="category-filter" class="border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">Semua Kategori</option>
                        <option value="Makanan">Makanan</option>
                        <option value="Minuman">Minuman</option>
                        <option value="Snack">Snack</option>
                        <option value="Dairy">Dairy</option>
                    </select>
                    <button onclick="filterProducts()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        üîç Filter
                    </button>
                </div>
            </div>

            <!-- Products Table -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Barcode</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Nama Produk</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Kategori</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Harga Beli</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Harga Jual</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Stok</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="products-table">
                            <tr>
                                <td colspan="7" class="text-center py-8 text-gray-500">Belum ada produk. Tambahkan produk pertama Anda!</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Transaction Section -->
        <div id="transaction-section" class="p-8 hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Panel - Product Search & Cart -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Customer Selection -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h3 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Informasi Pelanggan</h3>
                        <div class="flex space-x-3">
                            <select id="customer-select" class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="">Pelanggan Umum</option>
                            </select>
                            <button onclick="showAddCustomerFromTransaction()" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors">
                                üë§ Tambah Pelanggan
                            </button>
                        </div>
                    </div>

                    <!-- Product Search -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Cari Produk</h3>
                        <div class="flex space-x-3">
                            <input type="text" id="transaction-search" placeholder="Scan barcode atau cari nama produk..." class="flex-1 border border-gray-300 rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            <button onclick="startBarcodeScanner()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors">
                                üì∑ Scan
                            </button>
                            <button onclick="searchProduct()" class="bg-success text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors">
                                üîç Cari
                            </button>
                        </div>
                        
                        <!-- Quick Product Grid -->
                        <div class="mt-4">
                            <h4 class="font-semibold text-gray-700 mb-3">Produk Populer</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="quick-products">
                                <!-- Quick products will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Shopping Cart -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Keranjang Belanja</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-3 px-2 font-semibold text-gray-700">Produk</th>
                                        <th class="text-left py-3 px-2 font-semibold text-gray-700">Harga</th>
                                        <th class="text-left py-3 px-2 font-semibold text-gray-700">Qty</th>
                                        <th class="text-left py-3 px-2 font-semibold text-gray-700">Subtotal</th>
                                        <th class="text-left py-3 px-2 font-semibold text-gray-700">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="cart-items">
                                    <tr>
                                        <td colspan="5" class="text-center py-8 text-gray-500">Keranjang kosong</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Right Panel - Payment -->
                <div class="space-y-6">
                    <!-- Payment Summary -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Ringkasan Pembayaran</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Subtotal:</span>
                                <span class="font-semibold" id="subtotal">Rp 0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Diskon:</span>
                                <span class="font-semibold text-red-500" id="discount">Rp 0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">PPN 11%:</span>
                                <span class="font-semibold" id="tax">Rp 0</span>
                            </div>
                            <div class="border-t pt-3">
                                <div class="flex justify-between">
                                    <span class="text-xl font-bold text-gray-800">TOTAL:</span>
                                    <span class="text-2xl font-bold text-success" id="total">Rp 0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Metode Pembayaran</h3>
                        <div class="space-y-3">
                            <button onclick="selectPaymentMethod('cash')" class="payment-method w-full text-left p-4 border-2 border-primary bg-primary text-white rounded-lg font-semibold transition-colors">
                                üíµ Cash
                            </button>
                            <button onclick="selectPaymentMethod('ewallet')" class="payment-method w-full text-left p-4 border-2 border-gray-300 rounded-lg font-semibold hover:border-primary transition-colors">
                                üì± E-Wallet
                            </button>
                            <button onclick="selectPaymentMethod('card')" class="payment-method w-full text-left p-4 border-2 border-gray-300 rounded-lg font-semibold hover:border-primary transition-colors">
                                üí≥ Kartu Kredit/Debit
                            </button>
                        </div>

                        <!-- Cash Input -->
                        <div id="cash-input" class="mt-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Jumlah Bayar</label>
                            <input type="number" id="cash-amount" placeholder="0" class="w-full border border-gray-300 rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            <div class="mt-2">
                                <span class="text-sm text-gray-600">Kembalian: </span>
                                <span class="font-bold text-success" id="change">Rp 0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Process Payment -->
                    <button onclick="processPayment()" class="w-full bg-success text-white py-4 rounded-lg text-xl font-bold hover:bg-green-600 transition-colors disabled:bg-gray-400" id="process-btn" disabled>
                        üõí Proses Pembayaran
                    </button>

                    <!-- Quick Actions -->
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="clearCart()" class="bg-red-500 text-white py-3 rounded-lg font-semibold hover:bg-red-600 transition-colors">
                            üóëÔ∏è Kosongkan
                        </button>
                        <button onclick="holdTransaction()" class="bg-yellow-500 text-white py-3 rounded-lg font-semibold hover:bg-yellow-600 transition-colors">
                            ‚è∏Ô∏è Tahan
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports-section" class="p-8 hidden">
            <div class="mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Laporan Penjualan</h3>
                <p class="text-gray-600">Analisis performa penjualan dan inventori</p>
            </div>

            <!-- Report Filters -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Dari Tanggal</label>
                        <input type="date" id="report-start-date" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Sampai Tanggal</label>
                        <input type="date" id="report-end-date" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Kategori</label>
                        <select id="report-category" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                            <option value="">Semua Kategori</option>
                            <option value="Makanan">Makanan</option>
                            <option value="Minuman">Minuman</option>
                            <option value="Snack">Snack</option>
                            <option value="Dairy">Dairy</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="generateReport()" class="w-full bg-primary text-white py-2 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                            üìä Generate Laporan
                        </button>
                    </div>
                    <div class="flex items-end">
                        <button onclick="printDailyReport()" class="w-full bg-green-500 text-white py-2 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                            üñ®Ô∏è Print Hari Ini
                        </button>
                    </div>
                </div>
            </div>

            <!-- Report Summary -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Total Penjualan</p>
                            <p class="text-2xl font-bold text-primary" id="report-total-sales">Rp 0</p>
                        </div>
                        <div class="text-3xl">üí∞</div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Total Transaksi</p>
                            <p class="text-2xl font-bold text-success" id="report-total-transactions">0</p>
                        </div>
                        <div class="text-3xl">üõí</div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Modal Keluar</p>
                            <p class="text-2xl font-bold text-red-500" id="report-total-cost">Rp 0</p>
                        </div>
                        <div class="text-3xl">üì§</div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Keuntungan Bersih</p>
                            <p class="text-2xl font-bold text-green-600" id="report-total-profit">Rp 0</p>
                        </div>
                        <div class="text-3xl">üíé</div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Margin Profit</p>
                            <p class="text-2xl font-bold text-purple-600" id="report-profit-margin">0%</p>
                        </div>
                        <div class="text-3xl">üìä</div>
                    </div>
                </div>
            </div>

            <!-- Report History -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-montserrat font-bold text-gray-800">Riwayat Laporan Tersimpan</h4>
                    <button onclick="clearReportHistory()" class="bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600 transition-colors">
                        üóëÔ∏è Hapus Semua
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200 bg-gray-50">
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Nama Laporan</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Periode</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Total Penjualan</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Transaksi</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Dibuat</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="saved-reports">
                            <tr>
                                <td colspan="6" class="text-center py-8 text-gray-500">Belum ada laporan tersimpan</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Transactions Table -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-montserrat font-bold text-gray-800">Detail Transaksi</h4>
                    <div class="flex space-x-2">
                        <button onclick="saveCurrentReport()" class="bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                            üíæ Simpan Laporan
                        </button>
                        <button onclick="exportReportExcel()" class="bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                            üìä Export Excel
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200 bg-gray-50">
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Invoice</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Tanggal</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Items</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Modal</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Penjualan</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Profit</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Pembayaran</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="report-transactions">
                            <tr>
                                <td colspan="8" class="text-center py-8 text-gray-500">Pilih rentang tanggal untuk melihat laporan</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Customers Section -->
        <div id="customers-section" class="p-8 hidden">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-xl font-montserrat font-bold text-gray-800">Manajemen Pelanggan</h3>
                    <p class="text-gray-600">Kelola data pelanggan dan program loyalitas</p>
                </div>
                <button onclick="showAddCustomerModal()" class="bg-success text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                    ‚ûï Tambah Pelanggan
                </button>
            </div>

            <!-- Customer Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm">Total Pelanggan</p>
                            <p class="text-2xl font-bold" id="total-customers">0</p>
                        </div>
                        <div class="text-4xl opacity-80">üë•</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm">Member Aktif</p>
                            <p class="text-2xl font-bold" id="active-members">0</p>
                        </div>
                        <div class="text-4xl opacity-80">‚≠ê</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm">Total Poin</p>
                            <p class="text-2xl font-bold" id="total-points">0</p>
                        </div>
                        <div class="text-4xl opacity-80">üéØ</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-100 text-sm">Transaksi Bulan Ini</p>
                            <p class="text-2xl font-bold" id="monthly-customer-transactions">0</p>
                        </div>
                        <div class="text-4xl opacity-80">üõí</div>
                    </div>
                </div>
            </div>

            <!-- Search and Filter -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex flex-wrap gap-4">
                    <input type="text" id="customer-search" placeholder="Cari nama atau nomor telepon..." class="flex-1 min-w-64 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                    <select id="customer-type-filter" class="border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">Semua Tipe</option>
                        <option value="regular">Regular</option>
                        <option value="member">Member</option>
                        <option value="vip">VIP</option>
                    </select>
                    <button onclick="filterCustomers()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        üîç Filter
                    </button>
                </div>
            </div>

            <!-- Customers Table -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Nama</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Kontak</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Tipe</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Poin</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Total Belanja</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Terakhir Belanja</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="customers-table">
                            <tr>
                                <td colspan="7" class="text-center py-8 text-gray-500">Belum ada data pelanggan</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Backup Data Section -->
        <div id="backup-section" class="p-8 hidden">
            <div class="mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Backup & Restore Data</h3>
                <p class="text-gray-600">Kelola backup dan restore data sistem POS</p>
            </div>

            <!-- Backup Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm">Total Produk</p>
                            <p class="text-2xl font-bold" id="backup-total-products">0</p>
                        </div>
                        <div class="text-4xl opacity-80">üì¶</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm">Total Transaksi</p>
                            <p class="text-2xl font-bold" id="backup-total-transactions">0</p>
                        </div>
                        <div class="text-4xl opacity-80">üõí</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm">Total Pelanggan</p>
                            <p class="text-2xl font-bold" id="backup-total-customers">0</p>
                        </div>
                        <div class="text-4xl opacity-80">üë•</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-100 text-sm">Total Laporan</p>
                            <p class="text-2xl font-bold" id="backup-total-reports">0</p>
                        </div>
                        <div class="text-4xl opacity-80">üìä</div>
                    </div>
                </div>
            </div>

            <!-- Backup Actions -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <!-- Full Backup -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center text-white text-2xl mr-4">
                            üíæ
                        </div>
                        <div>
                            <h4 class="text-lg font-montserrat font-bold text-gray-800">Backup Lengkap</h4>
                            <p class="text-sm text-gray-600">Backup semua data sistem</p>
                        </div>
                    </div>
                    <p class="text-gray-700 mb-4">Mencakup semua produk, transaksi, pelanggan, laporan, dan pengaturan toko.</p>
                    <button onclick="createFullBackup()" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                        üì• Buat Backup Lengkap
                    </button>
                </div>

                <!-- Quick Backup -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center text-white text-2xl mr-4">
                            ‚ö°
                        </div>
                        <div>
                            <h4 class="text-lg font-montserrat font-bold text-gray-800">Backup Cepat</h4>
                            <p class="text-sm text-gray-600">Backup data penting saja</p>
                        </div>
                    </div>
                    <p class="text-gray-700 mb-4">Mencakup semua produk dan 100 transaksi terakhir. Ukuran file lebih kecil.</p>
                    <button onclick="createQuickBackup()" class="w-full bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        ‚ö° Buat Backup Cepat
                    </button>
                </div>
            </div>

            <!-- Restore Section -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-orange-500 rounded-lg flex items-center justify-center text-white text-2xl mr-4">
                        üîÑ
                    </div>
                    <div>
                        <h4 class="text-lg font-montserrat font-bold text-gray-800">Restore Data</h4>
                        <p class="text-sm text-gray-600">Pulihkan data dari file backup</p>
                    </div>
                </div>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                    <div class="flex">
                        <div class="text-yellow-400 text-xl mr-3">‚ö†Ô∏è</div>
                        <div>
                            <h5 class="text-yellow-800 font-semibold">Peringatan Restore</h5>
                            <p class="text-yellow-700 text-sm">Restore akan mengganti SEMUA data yang ada saat ini. Pastikan Anda telah membuat backup terlebih dahulu.</p>
                        </div>
                    </div>
                </div>
                <button onclick="restoreFromFile()" class="bg-orange-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-orange-600 transition-colors">
                    üìÇ Pilih File Backup untuk Restore
                </button>
            </div>

            <!-- Individual Export -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h4 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Export Data Individual</h4>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <button onclick="exportProducts()" class="bg-blue-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                        üì¶ Export Produk
                    </button>
                    <button onclick="exportTransactions()" class="bg-green-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        üõí Export Transaksi
                    </button>
                    <button onclick="exportCustomers()" class="bg-purple-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-purple-600 transition-colors">
                        üë• Export Pelanggan
                    </button>
                    <button onclick="exportReports()" class="bg-orange-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-orange-600 transition-colors">
                        üìä Export Laporan
                    </button>
                </div>
            </div>

            <!-- Backup History -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-montserrat font-bold text-gray-800">Riwayat Backup & Restore</h4>
                    <div class="flex space-x-2">
                        <button onclick="showRestoreHistory()" class="bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                            üìú Riwayat Restore
                        </button>
                        <button onclick="clearBackupHistory()" class="bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600 transition-colors">
                            üóëÔ∏è Hapus Riwayat
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200 bg-gray-50">
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Tanggal</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Tipe</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Ukuran</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="backup-history">
                            <tr>
                                <td colspan="5" class="text-center py-8 text-gray-500">Belum ada riwayat backup</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings-section" class="p-8 hidden">
            <div class="mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Pengaturan Toko</h3>
                <p class="text-gray-600">Kelola informasi toko dan preferensi sistem</p>
            </div>

            <!-- Store Profile -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h4 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Profil Toko</h4>
                <form id="store-settings-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Toko</label>
                            <input type="text" id="store-name" value="Toko Maju Jaya" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Pemilik</label>
                            <input type="text" id="store-owner" value="Budi Santoso" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Alamat Toko</label>
                        <textarea id="store-address" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary" rows="2">Jl. Raya Utama No. 123, Jakarta Selatan</textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Nomor Telepon</label>
                            <input type="text" id="store-phone" value="(021) 1234-5678" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Email</label>
                            <input type="email" id="store-email" value="info@tokumajujaya.com" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">NPWP</label>
                            <input type="text" id="store-npwp" value="12.345.678.9-012.000" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">NIB</label>
                            <input type="text" id="store-nib" value="1234567890123" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                    </div>
                    
                    <div class="pt-4">
                        <button type="submit" class="bg-success text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                            üíæ Simpan Pengaturan
                        </button>
                    </div>
                </form>
            </div>

            <!-- System Settings -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h4 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Pengaturan Sistem</h4>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h5 class="font-semibold text-gray-800">Auto Print Struk</h5>
                            <p class="text-sm text-gray-600">Cetak struk otomatis setelah transaksi</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="auto-print" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div>
                            <h5 class="font-semibold text-gray-800">Peringatan Stok Rendah</h5>
                            <p class="text-sm text-gray-600">Tampilkan notifikasi saat stok ‚â§ 10</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="low-stock-alert" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div>
                            <h5 class="font-semibold text-gray-800">Suara Notifikasi</h5>
                            <p class="text-sm text-gray-600">Mainkan suara saat scan barcode berhasil</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="sound-notification" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h4 class="text-lg font-montserrat font-bold text-gray-800 mb-4">Manajemen Data</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="exportAllData()" class="bg-blue-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                        üì§ Export Data
                    </button>
                    <button onclick="importData()" class="bg-green-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        üì• Import Data
                    </button>
                    <button onclick="resetAllData()" class="bg-red-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-red-600 transition-colors">
                        üóëÔ∏è Reset Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Barcode Scanner Modal -->
    <div id="barcode-scanner-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-lg w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">üì∑ Barcode Scanner</h3>
                <button onclick="stopBarcodeScanner()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>
            
            <div class="text-center">
                <div id="scanner-container" class="relative mb-4">
                    <video id="scanner-video" class="w-full h-64 bg-black rounded-lg object-cover"></video>
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <div class="relative">
                            <!-- Scanning frame -->
                            <div class="w-48 h-32 border-2 border-red-500 border-dashed rounded-lg animate-pulse"></div>
                            <!-- Corner indicators -->
                            <div class="absolute top-0 left-0 w-6 h-6 border-t-4 border-l-4 border-red-500 rounded-tl-lg"></div>
                            <div class="absolute top-0 right-0 w-6 h-6 border-t-4 border-r-4 border-red-500 rounded-tr-lg"></div>
                            <div class="absolute bottom-0 left-0 w-6 h-6 border-b-4 border-l-4 border-red-500 rounded-bl-lg"></div>
                            <div class="absolute bottom-0 right-0 w-6 h-6 border-b-4 border-r-4 border-red-500 rounded-br-lg"></div>
                        </div>
                    </div>
                    <!-- Scanning line animation -->
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <div class="w-48 h-32 relative overflow-hidden rounded-lg">
                            <div class="absolute top-0 left-0 right-0 h-0.5 bg-red-500 animate-bounce" style="animation: scanLine 2s linear infinite;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3">
                        <p class="text-blue-800 text-sm font-semibold">üì± Tips Scanning:</p>
                        <ul class="text-blue-700 text-xs mt-1 space-y-1">
                            <li>‚Ä¢ Pastikan barcode dalam frame merah</li>
                            <li>‚Ä¢ Jaga jarak 10-20cm dari kamera</li>
                            <li>‚Ä¢ Pastikan pencahayaan cukup</li>
                            <li>‚Ä¢ Tahan steady hingga terdeteksi</li>
                        </ul>
                    </div>
                    
                    <div id="scanner-result" class="bg-green-50 border border-green-200 p-3 rounded-lg text-sm font-mono hidden">
                        <div class="flex items-center justify-center">
                            <span class="text-green-600 mr-2">‚úÖ Hasil scan:</span>
                            <span id="scanned-barcode" class="font-bold text-green-800"></span>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="stopBarcodeScanner()" class="bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                        ‚ùå Tutup
                    </button>
                    <button onclick="manualBarcodeInput()" class="bg-primary text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                        ‚å®Ô∏è Input Manual
                    </button>
                </div>
                
                <div class="mt-3 text-xs text-gray-500">
                    üí° Jika scanner tidak bekerja, gunakan tombol "Input Manual"
                </div>
            </div>
        </div>
    </div>
    
    <style>
        @keyframes scanLine {
            0% { transform: translateY(0); }
            100% { transform: translateY(128px); }
        }
    </style>

    <!-- Manual Barcode Input Modal -->
    <div id="manual-barcode-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Input Barcode Manual</h3>
                <button onclick="hideManualBarcodeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Masukkan Barcode</label>
                    <input type="text" id="manual-barcode-input" placeholder="Ketik atau scan barcode..." class="w-full border border-gray-300 rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="processManualBarcode()" class="flex-1 bg-success text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        ‚úÖ Tambah ke Keranjang
                    </button>
                    <button onclick="hideManualBarcodeModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                        ‚ùå Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="add-product-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Tambah Produk Baru</h3>
                <button onclick="hideAddProductModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>
            
            <form id="add-product-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Barcode</label>
                    <div class="flex space-x-2">
                        <input type="text" id="new-barcode" required class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <button type="button" onclick="scanBarcodeForNewProduct()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            üì∑
                        </button>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Produk</label>
                    <input type="text" id="new-name" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Kategori</label>
                    <select id="new-category" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">Pilih Kategori</option>
                        <option value="Makanan">Makanan</option>
                        <option value="Minuman">Minuman</option>
                        <option value="Snack">Snack</option>
                        <option value="Dairy">Dairy</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Harga Beli</label>
                        <input type="number" id="new-buy-price" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Harga Jual</label>
                        <input type="number" id="new-sell-price" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Stok Awal</label>
                    <input type="number" id="new-stock" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-success text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        üíæ Simpan Produk
                    </button>
                    <button type="button" onclick="hideAddProductModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                        ‚ùå Batal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div id="edit-product-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Edit Produk</h3>
                <button onclick="hideEditProductModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>
            
            <form id="edit-product-form" class="space-y-4">
                <input type="hidden" id="edit-product-id">
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Barcode</label>
                    <input type="text" id="edit-barcode" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Produk</label>
                    <input type="text" id="edit-name" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Kategori</label>
                    <select id="edit-category" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">Pilih Kategori</option>
                        <option value="Makanan">Makanan</option>
                        <option value="Minuman">Minuman</option>
                        <option value="Snack">Snack</option>
                        <option value="Dairy">Dairy</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Harga Beli</label>
                        <input type="number" id="edit-buy-price" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Harga Jual</label>
                        <input type="number" id="edit-sell-price" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Stok</label>
                    <input type="number" id="edit-stock" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-success text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        üíæ Update Produk
                    </button>
                    <button type="button" onclick="hideEditProductModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                        ‚ùå Batal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="keyboard-shortcuts-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-lg w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Keyboard Shortcuts</h3>
                <button onclick="hideKeyboardShortcuts()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>
            
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span class="font-semibold">Dashboard</span>
                            <kbd class="bg-gray-200 px-2 py-1 rounded text-sm">1</kbd>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span class="font-semibold">Produk</span>
                            <kbd class="bg-gray-200 px-2 py-1 rounded text-sm">2</kbd>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span class="font-semibold">Transaksi</span>
                            <kbd class="bg-gray-200 px-2 py-1 rounded text-sm">3</kbd>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span class="font-semibold">Laporan</span>
                            <kbd class="bg-gray-200 px-2 py-1 rounded text-sm">4</kbd>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span class="font-semibold">Pelanggan</span>
                            <kbd class="bg-gray-200 px-2 py-1 rounded text-sm">5</kbd>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span class="font-semibold">Pengaturan</span>
                            <kbd class="bg-gray-200 px-2 py-1 rounded text-sm">6</kbd>
                        </div>
                    </div>
                </div>
                
                <div class="border-t pt-4">
                    <h4 class="font-semibold text-gray-800 mb-3">Transaksi</h4>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between">
                            <span>Fokus ke Pencarian Produk</span>
                            <kbd class="bg-gray-200 px-2 py-1 rounded text-sm">F2</kbd>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Proses Pembayaran</span>
                            <kbd class="bg-gray-200 px-2 py-1 rounded text-sm">F9</kbd>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Tutup Modal</span>
                            <kbd class="bg-gray-200 px-2 py-1 rounded text-sm">Esc</kbd>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-6">
                <button onclick="hideKeyboardShortcuts()" class="w-full bg-primary text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                    ‚úÖ Mengerti
                </button>
            </div>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="add-customer-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Tambah Pelanggan Baru</h3>
                <button onclick="hideAddCustomerModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>
            
            <form id="add-customer-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Lengkap</label>
                    <input type="text" id="new-customer-name" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nomor Telepon</label>
                    <input type="tel" id="new-customer-phone" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Email (Opsional)</label>
                    <input type="email" id="new-customer-email" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Alamat</label>
                    <textarea id="new-customer-address" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary" rows="3"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Tipe Pelanggan</label>
                    <select id="new-customer-type" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="regular">Regular</option>
                        <option value="member">Member</option>
                        <option value="vip">VIP</option>
                    </select>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-success text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        üíæ Simpan Pelanggan
                    </button>
                    <button type="button" onclick="hideAddCustomerModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                        ‚ùå Batal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Customer Modal -->
    <div id="edit-customer-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Edit Pelanggan</h3>
                <button onclick="hideEditCustomerModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>
            
            <form id="edit-customer-form" class="space-y-4">
                <input type="hidden" id="edit-customer-id">
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Lengkap</label>
                    <input type="text" id="edit-customer-name" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nomor Telepon</label>
                    <input type="tel" id="edit-customer-phone" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Email</label>
                    <input type="email" id="edit-customer-email" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Alamat</label>
                    <textarea id="edit-customer-address" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary" rows="3"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Tipe Pelanggan</label>
                    <select id="edit-customer-type" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="regular">Regular</option>
                        <option value="member">Member</option>
                        <option value="vip">VIP</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Poin Saat Ini</label>
                        <input type="number" id="edit-customer-points" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Total Belanja</label>
                        <input type="number" id="edit-customer-total-spent" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-100">
                    </div>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-success text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        üíæ Update Pelanggan
                    </button>
                    <button type="button" onclick="hideEditCustomerModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                        ‚ùå Batal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Detail Modal -->
    <div id="customer-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Detail Pelanggan</h3>
                <button onclick="hideCustomerDetailModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>
            
            <div id="customer-detail-content">
                <!-- Customer detail content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Transaction Detail Modal -->
    <div id="transaction-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Detail Transaksi</h3>
                <button onclick="hideTransactionDetailModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>
            
            <div id="transaction-detail-content">
                <!-- Transaction detail content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Save Report Modal -->
    <div id="save-report-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Simpan Laporan</h3>
                <button onclick="hideSaveReportModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>
            
            <form id="save-report-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Laporan</label>
                    <input type="text" id="report-name" required placeholder="Contoh: Laporan Penjualan Januari 2024" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Deskripsi (Opsional)</label>
                    <textarea id="report-description" placeholder="Deskripsi singkat tentang laporan ini..." class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary" rows="3"></textarea>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-800 mb-2">Ringkasan Laporan</h4>
                    <div class="text-sm text-gray-600 space-y-1">
                        <div class="flex justify-between">
                            <span>Periode:</span>
                            <span id="save-period"></span>
                        </div>
                        <div class="flex justify-between">
                            <span>Total Penjualan:</span>
                            <span id="save-total-sales"></span>
                        </div>
                        <div class="flex justify-between">
                            <span>Total Modal:</span>
                            <span id="save-total-cost"></span>
                        </div>
                        <div class="flex justify-between">
                            <span>Total Profit:</span>
                            <span id="save-total-profit"></span>
                        </div>
                        <div class="flex justify-between">
                            <span>Jumlah Transaksi:</span>
                            <span id="save-total-transactions"></span>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-success text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        üíæ Simpan Laporan
                    </button>
                    <button type="button" onclick="hideSaveReportModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                        ‚ùå Batal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receipt-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full mx-4">
            <div class="text-center mb-6">
                <h3 class="text-xl font-montserrat font-bold text-gray-800">Struk Pembayaran</h3>
            </div>
            
            <div id="receipt-content" class="border-2 border-dashed border-gray-300 p-4">
                <!-- Receipt content will be generated here -->
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="printReceipt()" class="flex-1 bg-primary text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                    üñ®Ô∏è Print
                </button>
                <button onclick="hideReceiptModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                    ‚úÖ Selesai
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let products = [];
        let cart = [];
        let transactions = [];
        let reports = [];
        let customers = [];
        let currentPaymentMethod = 'cash';
        let invoiceCounter = 1;
        let codeReader = null;
        let isScanning = false;
        let storeSettings = {
            name: 'Toko Maju Jaya',
            owner: 'Budi Santoso',
            address: 'Jl. Raya Utama No. 123, Jakarta Selatan',
            phone: '(021) 1234-5678',
            email: 'info@tokumajujaya.com',
            npwp: '12.345.678.9-012.000',
            nib: '1234567890123'
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // Set default dates for reports
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('report-start-date').value = today;
            document.getElementById('report-end-date').value = today;
            
            // Load sample data
            loadSampleData();
            loadSampleCustomers();
            updateDashboard();
            renderProducts();
            renderQuickProducts();
            renderCustomers();
            updateCustomerStats();
            checkLowStock();
            
            // Initialize barcode scanner
            initBarcodeScanner();
            
            // Add keyboard shortcuts
            setupKeyboardShortcuts();
            
            // Load saved reports
            loadSavedReports();
            renderSavedReports();
            
            // Load store settings
            loadStoreSettings();
            
            // Populate customer dropdown
            populateCustomerDropdown();
            
            // Initialize backup system
            initBackupSystem();
            
            // Setup store settings form
            document.getElementById('store-settings-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                storeSettings.name = document.getElementById('store-name').value;
                storeSettings.owner = document.getElementById('store-owner').value;
                storeSettings.address = document.getElementById('store-address').value;
                storeSettings.phone = document.getElementById('store-phone').value;
                storeSettings.email = document.getElementById('store-email').value;
                storeSettings.npwp = document.getElementById('store-npwp').value;
                storeSettings.nib = document.getElementById('store-nib').value;
                
                saveStoreSettings();
                
                // Update sidebar store name
                const sidebarStoreName = document.querySelector('.font-montserrat.font-bold.text-lg');
                if (sidebarStoreName) {
                    sidebarStoreName.textContent = storeSettings.name;
                }
                
                alert('Pengaturan toko berhasil disimpan!');
            });
            
            // Add event listeners for transaction search
            document.getElementById('transaction-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    searchProduct();
                }
            });
            
            // Add event listeners for manual barcode input
            document.getElementById('manual-barcode-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    processManualBarcode();
                }
            });
        });

        // Keyboard Shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Don't trigger shortcuts when typing in input fields
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                    if (e.key === 'Escape') {
                        e.target.blur();
                        hideAllModals();
                    }
                    return;
                }
                
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showSection('dashboard');
                        break;
                    case '2':
                        e.preventDefault();
                        showSection('products');
                        break;
                    case '3':
                        e.preventDefault();
                        showSection('transaction');
                        break;
                    case '4':
                        e.preventDefault();
                        showSection('reports');
                        break;
                    case '5':
                        e.preventDefault();
                        showSection('customers');
                        break;
                    case '6':
                        e.preventDefault();
                        showSection('backup');
                        break;
                    case '7':
                        e.preventDefault();
                        showSection('settings');
                        break;
                    case 'F2':
                        e.preventDefault();
                        document.getElementById('transaction-search').focus();
                        break;
                    case 'F9':
                        e.preventDefault();
                        if (!document.getElementById('process-btn').disabled) {
                            processPayment();
                        }
                        break;
                    case 'Escape':
                        hideAllModals();
                        break;
                }
            });
        }

        function hideAllModals() {
            document.getElementById('barcode-scanner-modal').classList.add('hidden');
            document.getElementById('manual-barcode-modal').classList.add('hidden');
            document.getElementById('add-product-modal').classList.add('hidden');
            document.getElementById('edit-product-modal').classList.add('hidden');
            document.getElementById('add-customer-modal').classList.add('hidden');
            document.getElementById('edit-customer-modal').classList.add('hidden');
            document.getElementById('customer-detail-modal').classList.add('hidden');
            document.getElementById('keyboard-shortcuts-modal').classList.add('hidden');
            document.getElementById('receipt-modal').classList.add('hidden');
            document.getElementById('save-report-modal').classList.add('hidden');
            document.getElementById('transaction-detail-modal').classList.add('hidden');
            stopBarcodeScanner();
        }

        function showKeyboardShortcuts() {
            document.getElementById('keyboard-shortcuts-modal').classList.remove('hidden');
        }

        function hideKeyboardShortcuts() {
            document.getElementById('keyboard-shortcuts-modal').classList.add('hidden');
        }

        // Barcode Scanner Functions
        function initBarcodeScanner() {
            try {
                if (typeof ZXing !== 'undefined' && ZXing.BrowserMultiFormatReader) {
                    codeReader = new ZXing.BrowserMultiFormatReader();
                    console.log('Barcode scanner initialized successfully');
                } else {
                    console.warn('ZXing library not loaded properly');
                }
            } catch (error) {
                console.error('Error initializing barcode scanner:', error);
            }
        }

        function startBarcodeScanner() {
            document.getElementById('barcode-scanner-modal').classList.remove('hidden');
            const video = document.getElementById('scanner-video');
            
            // Check if camera is available
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert('üì± Kamera tidak didukung di browser ini.\n\nSolusi:\n‚Ä¢ Gunakan Chrome/Safari terbaru\n‚Ä¢ Pastikan mengakses via HTTPS\n‚Ä¢ Coba refresh halaman\n\nMenggunakan input manual...');
                stopBarcodeScanner();
                manualBarcodeInput();
                return;
            }
            
            // Enhanced camera constraints for better mobile support
            const constraints = {
                video: {
                    width: { min: 320, ideal: 640, max: 1920 },
                    height: { min: 240, ideal: 480, max: 1080 },
                    facingMode: { ideal: 'environment' }, // Prefer back camera
                    focusMode: { ideal: 'continuous' },
                    exposureMode: { ideal: 'continuous' },
                    whiteBalanceMode: { ideal: 'continuous' }
                }
            };
            
            // Request camera permission with enhanced error handling
            navigator.mediaDevices.getUserMedia(constraints)
            .then(stream => {
                video.srcObject = stream;
                video.setAttribute('playsinline', true);
                video.setAttribute('autoplay', true);
                video.setAttribute('muted', true);
                
                // Wait for video to be ready
                video.addEventListener('loadedmetadata', () => {
                    video.play().then(() => {
                        console.log('üìπ Video stream started successfully');
                        
                        // Initialize barcode reader if available
                        if (codeReader) {
                            try {
                                codeReader.decodeFromVideoDevice(null, video, (result, err) => {
                                    if (result) {
                                        const barcode = result.text;
                                        console.log('üìä Barcode detected:', barcode);
                                        
                                        document.getElementById('scanned-barcode').textContent = barcode;
                                        document.getElementById('scanner-result').classList.remove('hidden');
                                        
                                        // Play success sound if enabled
                                        if (document.getElementById('sound-notification').checked) {
                                            playSuccessSound();
                                        }
                                        
                                        // Auto-add to cart after 1.5 seconds
                                        setTimeout(() => {
                                            addProductByBarcode(barcode);
                                            stopBarcodeScanner();
                                        }, 1500);
                                    }
                                    
                                    if (err && !(err instanceof ZXing.NotFoundException)) {
                                        console.warn('Barcode scanning error:', err);
                                    }
                                });
                                
                                isScanning = true;
                                console.log('üîç Barcode scanner initialized');
                                
                            } catch (scannerError) {
                                console.error('Scanner initialization error:', scannerError);
                                alert('‚ö†Ô∏è Error menginisialisasi scanner.\n\nMenggunakan input manual...');
                                stopBarcodeScanner();
                                manualBarcodeInput();
                            }
                        } else {
                            // Fallback: show camera but require manual input
                            console.warn('ZXing library not available');
                            setTimeout(() => {
                                alert('üì∑ Kamera aktif, tetapi scanner barcode tidak tersedia.\n\nAnda dapat:\n‚Ä¢ Lihat barcode di layar\n‚Ä¢ Input manual di bawah\n‚Ä¢ Gunakan aplikasi scanner lain');
                                // Don't stop scanner, let user see the camera
                            }, 2000);
                        }
                        
                    }).catch(playError => {
                        console.error('Video play error:', playError);
                        alert('‚ùå Tidak dapat memulai video.\n\nCoba:\n‚Ä¢ Refresh halaman\n‚Ä¢ Berikan izin kamera\n‚Ä¢ Gunakan browser lain\n\nMenggunakan input manual...');
                        stopBarcodeScanner();
                        manualBarcodeInput();
                    });
                });
                
                // Handle video errors
                video.addEventListener('error', (e) => {
                    console.error('Video error:', e);
                    alert('‚ùå Error pada video stream.\n\nMenggunakan input manual...');
                    stopBarcodeScanner();
                    manualBarcodeInput();
                });
                
            })
            .catch(err => {
                console.error('Camera access error:', err);
                let errorMessage = 'üì± Tidak dapat mengakses kamera.\n\n';
                let solutions = '';
                
                if (err.name === 'NotAllowedError') {
                    errorMessage += 'üö´ Izin kamera ditolak.';
                    solutions = '\nüí° Solusi:\n‚Ä¢ Klik ikon kamera di address bar\n‚Ä¢ Pilih "Allow" untuk kamera\n‚Ä¢ Refresh halaman dan coba lagi';
                } else if (err.name === 'NotFoundError') {
                    errorMessage += 'üì∑ Kamera tidak ditemukan.';
                    solutions = '\nüí° Solusi:\n‚Ä¢ Pastikan device memiliki kamera\n‚Ä¢ Tutup aplikasi lain yang menggunakan kamera\n‚Ä¢ Restart browser';
                } else if (err.name === 'NotSupportedError') {
                    errorMessage += '‚ö†Ô∏è Kamera tidak didukung di browser ini.';
                    solutions = '\nüí° Solusi:\n‚Ä¢ Gunakan Chrome/Safari terbaru\n‚Ä¢ Pastikan mengakses via HTTPS\n‚Ä¢ Coba browser lain';
                } else if (err.name === 'OverconstrainedError') {
                    errorMessage += '‚öôÔ∏è Pengaturan kamera tidak kompatibel.';
                    solutions = '\nüí° Solusi:\n‚Ä¢ Coba lagi dengan pengaturan berbeda\n‚Ä¢ Restart aplikasi kamera\n‚Ä¢ Gunakan input manual';
                } else {
                    errorMessage += `‚ùì Error: ${err.message}`;
                    solutions = '\nüí° Solusi:\n‚Ä¢ Refresh halaman\n‚Ä¢ Restart browser\n‚Ä¢ Gunakan input manual';
                }
                
                alert(errorMessage + solutions + '\n\nüîß Menggunakan input manual...');
                stopBarcodeScanner();
                manualBarcodeInput();
            });
        }

        function stopBarcodeScanner() {
            if (codeReader && isScanning) {
                codeReader.reset();
                isScanning = false;
            }
            
            // Stop video stream
            const video = document.getElementById('scanner-video');
            if (video.srcObject) {
                const tracks = video.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                video.srcObject = null;
            }
            
            document.getElementById('barcode-scanner-modal').classList.add('hidden');
            document.getElementById('scanner-result').classList.add('hidden');
        }

        function manualBarcodeInput() {
            stopBarcodeScanner();
            document.getElementById('manual-barcode-modal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('manual-barcode-input').focus();
            }, 100);
        }

        function hideManualBarcodeModal() {
            document.getElementById('manual-barcode-modal').classList.add('hidden');
            document.getElementById('manual-barcode-input').value = '';
        }

        function processManualBarcode() {
            const barcode = document.getElementById('manual-barcode-input').value.trim();
            if (barcode) {
                addProductByBarcode(barcode);
                hideManualBarcodeModal();
            } else {
                alert('Masukkan barcode terlebih dahulu!');
            }
        }

        function addProductByBarcode(barcode) {
            const product = products.find(p => p.barcode === barcode);
            if (product) {
                addToCart(product.id);
            } else {
                alert(`Produk dengan barcode ${barcode} tidak ditemukan!`);
            }
        }

        function scanBarcodeForNewProduct() {
            if (!codeReader) {
                alert('Scanner tidak tersedia. Silakan input manual.');
                return;
            }
            
            document.getElementById('barcode-scanner-modal').classList.remove('hidden');
            const video = document.getElementById('scanner-video');
            
            codeReader.decodeFromVideoDevice(null, video, (result, err) => {
                if (result) {
                    const barcode = result.text;
                    document.getElementById('new-barcode').value = barcode;
                    stopBarcodeScanner();
                }
            });
            
            isScanning = true;
        }

        // Time Update
        function updateCurrentTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('current-time').textContent = now.toLocaleDateString('id-ID', options);
        }

        // Navigation
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('[id$="-section"]').forEach(el => el.classList.add('hidden'));
            
            // Show selected section
            document.getElementById(section + '-section').classList.remove('hidden');
            
            // Update navigation - find the clicked button
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('text-gray-700', 'hover:bg-gray-100');
            });
            
            // Find and highlight the active button
            const activeBtn = document.querySelector(`button[onclick="showSection('${section}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('bg-primary', 'text-white');
                activeBtn.classList.remove('text-gray-700', 'hover:bg-gray-100');
            }
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'products': 'Manajemen Produk',
                'transaction': 'Transaksi Penjualan',
                'reports': 'Laporan Penjualan',
                'customers': 'Manajemen Pelanggan',
                'backup': 'Backup & Restore Data',
                'settings': 'Pengaturan Toko'
            };
            document.getElementById('page-title').textContent = titles[section];
            
            // Initialize charts if dashboard
            if (section === 'dashboard') {
                setTimeout(initCharts, 100);
            }
            
            // Update backup stats if backup section
            if (section === 'backup') {
                updateBackupStats();
            }
        }

        // Load Sample Data
        function loadSampleData() {
            products = [
                {
                    id: 1,
                    barcode: '8997011553001',
                    name: 'Susu Ultra 1L',
                    category: 'Dairy',
                    buyPrice: 9500,
                    sellPrice: 12000,
                    stock: 45
                },
                {
                    id: 2,
                    barcode: '8997011554002',
                    name: 'Indomie Goreng',
                    category: 'Makanan',
                    buyPrice: 2800,
                    sellPrice: 3500,
                    stock: 120
                },
                {
                    id: 3,
                    barcode: '8997011555003',
                    name: 'Aqua 600ml',
                    category: 'Minuman',
                    buyPrice: 2000,
                    sellPrice: 3000,
                    stock: 80
                },
                {
                    id: 4,
                    barcode: '8997011556004',
                    name: 'Chitato Sapi Panggang',
                    category: 'Snack',
                    buyPrice: 8500,
                    sellPrice: 11000,
                    stock: 25
                },
                {
                    id: 5,
                    barcode: '8997011557005',
                    name: 'Teh Botol Sosro',
                    category: 'Minuman',
                    buyPrice: 3200,
                    sellPrice: 4500,
                    stock: 5
                },
                {
                    id: 6,
                    barcode: '8997011558006',
                    name: 'Roti Tawar Sari Roti',
                    category: 'Makanan',
                    buyPrice: 4500,
                    sellPrice: 6000,
                    stock: 8
                }
            ];

            // Initialize empty transactions - will be populated when actual transactions occur
            transactions = [];
            invoiceCounter = 1;
        }

        // Low Stock Functions
        function checkLowStock() {
            const lowStockProducts = products.filter(p => p.stock <= 10);
            const alertElement = document.getElementById('low-stock-alert');
            const warningElement = document.getElementById('dashboard-low-stock-warning');
            const countElement = document.getElementById('low-stock-count');
            
            if (lowStockProducts.length > 0) {
                alertElement.style.display = 'block';
                warningElement.style.display = 'block';
                countElement.textContent = lowStockProducts.length;
            } else {
                alertElement.style.display = 'none';
                warningElement.style.display = 'none';
            }
        }

        function showLowStockAlert() {
            const lowStockProducts = products.filter(p => p.stock <= 10);
            if (lowStockProducts.length === 0) return;
            
            const productList = lowStockProducts.map(p => `‚Ä¢ ${p.name} (Stok: ${p.stock})`).join('\n');
            alert(`Produk dengan stok rendah (‚â§10):\n\n${productList}\n\nSegera lakukan restok!`);
        }

        // Dashboard Functions
        function updateDashboard() {
            const today = new Date();
            const todayStr = today.toDateString();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // Daily statistics
            const todayTransactions = transactions.filter(t => new Date(t.date).toDateString() === todayStr);
            const dailySales = todayTransactions.reduce((sum, t) => sum + t.total, 0);
            const dailyProfit = todayTransactions.reduce((sum, t) => sum + (t.totalProfit || 0), 0);
            const dailyTransactionCount = todayTransactions.length;
            const dailyMargin = dailySales > 0 ? (dailyProfit / dailySales * 100) : 0;
            
            // Monthly statistics
            const monthlyTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear;
            });
            const monthlySales = monthlyTransactions.reduce((sum, t) => sum + t.total, 0);
            const monthlyProfit = monthlyTransactions.reduce((sum, t) => sum + (t.totalProfit || 0), 0);
            const monthlyTransactionCount = monthlyTransactions.length;
            const monthlyMargin = monthlySales > 0 ? (monthlyProfit / monthlySales * 100) : 0;
            
            // Update daily stats
            document.getElementById('daily-sales').textContent = formatCurrency(dailySales);
            document.getElementById('daily-profit').textContent = formatCurrency(dailyProfit);
            document.getElementById('daily-transactions').textContent = `${dailyTransactionCount} transaksi`;
            document.getElementById('daily-margin').textContent = `${dailyMargin.toFixed(1)}% margin`;
            
            // Update monthly stats
            document.getElementById('monthly-sales').textContent = formatCurrency(monthlySales);
            document.getElementById('monthly-profit').textContent = formatCurrency(monthlyProfit);
            document.getElementById('monthly-transactions').textContent = `${monthlyTransactionCount} transaksi`;
            document.getElementById('monthly-margin').textContent = `${monthlyMargin.toFixed(1)}% margin`;
            
            renderRecentTransactions();
            checkLowStock();
        }

        function renderRecentTransactions() {
            const tbody = document.getElementById('recent-transactions');
            const recent = transactions.slice(-5).reverse();
            
            if (recent.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">Belum ada transaksi hari ini</td></tr>';
                return;
            }
            
            tbody.innerHTML = recent.map(transaction => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4 font-semibold">${transaction.invoice}</td>
                    <td class="py-3 px-4">
                        <div>${new Date(transaction.date).toLocaleString('id-ID')}</div>
                        <div class="text-xs text-gray-600">${transaction.customerName || 'Pelanggan Umum'}</div>
                    </td>
                    <td class="py-3 px-4">${transaction.items.length} items</td>
                    <td class="py-3 px-4">${formatCurrency(transaction.total)}</td>
                    <td class="py-3 px-4">
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold">
                            ${transaction.paymentMethod}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        function initCharts() {
            // Sales Chart
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'],
                        datasets: [{
                            label: 'Penjualan (Rp)',
                            data: [1200000, 1900000, 800000, 2100000, 1600000, 2400000, 1800000],
                            borderColor: '#2563EB',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'Rp ' + (value / 1000000).toFixed(1) + 'M';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Category Chart
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Makanan', 'Minuman', 'Snack', 'Dairy'],
                        datasets: [{
                            data: [35, 25, 20, 20],
                            backgroundColor: ['#2563EB', '#10B981', '#F59E0B', '#8B5CF6']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        // Product Management
        function showAddProductModal() {
            document.getElementById('add-product-modal').classList.remove('hidden');
        }

        function hideAddProductModal() {
            document.getElementById('add-product-modal').classList.add('hidden');
            document.getElementById('add-product-form').reset();
        }

        document.getElementById('add-product-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newProduct = {
                id: products.length + 1,
                barcode: document.getElementById('new-barcode').value,
                name: document.getElementById('new-name').value,
                category: document.getElementById('new-category').value,
                buyPrice: parseInt(document.getElementById('new-buy-price').value),
                sellPrice: parseInt(document.getElementById('new-sell-price').value),
                stock: parseInt(document.getElementById('new-stock').value)
            };
            
            products.push(newProduct);
            renderProducts();
            renderQuickProducts();
            updateDashboard();
            hideAddProductModal();
            
            alert('Produk berhasil ditambahkan!');
        });

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            document.getElementById('edit-product-id').value = product.id;
            document.getElementById('edit-barcode').value = product.barcode;
            document.getElementById('edit-name').value = product.name;
            document.getElementById('edit-category').value = product.category;
            document.getElementById('edit-buy-price').value = product.buyPrice;
            document.getElementById('edit-sell-price').value = product.sellPrice;
            document.getElementById('edit-stock').value = product.stock;
            
            document.getElementById('edit-product-modal').classList.remove('hidden');
        }

        function hideEditProductModal() {
            document.getElementById('edit-product-modal').classList.add('hidden');
            document.getElementById('edit-product-form').reset();
        }

        document.getElementById('edit-product-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('edit-product-id').value);
            const product = products.find(p => p.id === id);
            
            if (product) {
                product.barcode = document.getElementById('edit-barcode').value;
                product.name = document.getElementById('edit-name').value;
                product.category = document.getElementById('edit-category').value;
                product.buyPrice = parseInt(document.getElementById('edit-buy-price').value);
                product.sellPrice = parseInt(document.getElementById('edit-sell-price').value);
                product.stock = parseInt(document.getElementById('edit-stock').value);
                
                renderProducts();
                renderQuickProducts();
                updateDashboard();
                hideEditProductModal();
                
                alert('Produk berhasil diupdate!');
            }
        });

        function renderProducts() {
            const tbody = document.getElementById('products-table');
            
            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">Belum ada produk. Tambahkan produk pertama Anda!</td></tr>';
                return;
            }
            
            tbody.innerHTML = products.map(product => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-4 px-6">
                        <div class="flex items-center">
                            <div class="w-12 h-8 bg-gray-800 mr-3 flex items-center justify-center rounded">
                                <div class="text-white text-xs">|||</div>
                            </div>
                            <span class="text-sm font-mono">${product.barcode}</span>
                        </div>
                    </td>
                    <td class="py-4 px-6">
                        <div class="font-semibold text-gray-800">${product.name}</div>
                    </td>
                    <td class="py-4 px-6">
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-semibold">
                            ${product.category}
                        </span>
                    </td>
                    <td class="py-4 px-6 text-gray-600">${formatCurrency(product.buyPrice)}</td>
                    <td class="py-4 px-6 font-semibold text-success">${formatCurrency(product.sellPrice)}</td>
                    <td class="py-4 px-6">
                        <span class="bg-${product.stock > 10 ? 'green' : 'red'}-100 text-${product.stock > 10 ? 'green' : 'red'}-800 px-3 py-1 rounded-full text-sm font-semibold">
                            ${product.stock}
                        </span>
                    </td>
                    <td class="py-4 px-6">
                        <div class="flex space-x-2">
                            <button onclick="editProduct(${product.id})" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors">
                                ‚úèÔ∏è Edit
                            </button>
                            <button onclick="deleteProduct(${product.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors">
                                üóëÔ∏è Hapus
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function filterProducts() {
            const search = document.getElementById('product-search').value.toLowerCase();
            const category = document.getElementById('category-filter').value;
            
            let filtered = products;
            
            if (search) {
                filtered = filtered.filter(p => 
                    p.name.toLowerCase().includes(search) || 
                    p.barcode.includes(search)
                );
            }
            
            if (category) {
                filtered = filtered.filter(p => p.category === category);
            }
            
            // Update table with filtered results
            const tbody = document.getElementById('products-table');
            tbody.innerHTML = filtered.map(product => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-4 px-6">
                        <div class="flex items-center">
                            <div class="w-12 h-8 bg-gray-800 mr-3 flex items-center justify-center rounded">
                                <div class="text-white text-xs">|||</div>
                            </div>
                            <span class="text-sm font-mono">${product.barcode}</span>
                        </div>
                    </td>
                    <td class="py-4 px-6">
                        <div class="font-semibold text-gray-800">${product.name}</div>
                    </td>
                    <td class="py-4 px-6">
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-semibold">
                            ${product.category}
                        </span>
                    </td>
                    <td class="py-4 px-6 text-gray-600">${formatCurrency(product.buyPrice)}</td>
                    <td class="py-4 px-6 font-semibold text-success">${formatCurrency(product.sellPrice)}</td>
                    <td class="py-4 px-6">
                        <span class="bg-${product.stock > 10 ? 'green' : 'red'}-100 text-${product.stock > 10 ? 'green' : 'red'}-800 px-3 py-1 rounded-full text-sm font-semibold">
                            ${product.stock}
                        </span>
                    </td>
                    <td class="py-4 px-6">
                        <div class="flex space-x-2">
                            <button onclick="editProduct(${product.id})" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors">
                                ‚úèÔ∏è Edit
                            </button>
                            <button onclick="deleteProduct(${product.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors">
                                üóëÔ∏è Hapus
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function deleteProduct(id) {
            if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
                products = products.filter(p => p.id !== id);
                renderProducts();
                renderQuickProducts();
                updateDashboard();
                alert('Produk berhasil dihapus!');
            }
        }

        // Transaction Functions
        function renderQuickProducts() {
            const container = document.getElementById('quick-products');
            const quickProducts = products.slice(0, 8);
            
            container.innerHTML = quickProducts.map(product => `
                <button onclick="addToCart(${product.id})" class="bg-white border border-gray-200 rounded-lg p-3 hover:border-primary hover:shadow-md transition-all">
                    <div class="text-2xl mb-1">${getCategoryEmoji(product.category)}</div>
                    <div class="text-xs font-semibold text-gray-800">${product.name}</div>
                    <div class="text-xs text-success font-bold">${formatCurrency(product.sellPrice)}</div>
                </button>
            `).join('');
        }

        function getCategoryEmoji(category) {
            const emojis = {
                'Makanan': 'üçú',
                'Minuman': 'ü•§',
                'Snack': 'üçø',
                'Dairy': 'ü•õ'
            };
            return emojis[category] || 'üì¶';
        }

        function searchProduct() {
            const search = document.getElementById('transaction-search').value.toLowerCase();
            if (!search) return;
            
            const product = products.find(p => 
                p.barcode.includes(search) || 
                p.name.toLowerCase().includes(search)
            );
            
            if (product) {
                addToCart(product.id);
                document.getElementById('transaction-search').value = '';
            } else {
                alert('Produk tidak ditemukan!');
            }
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            if (product.stock <= 0) {
                alert('Stok produk habis!');
                return;
            }
            
            const existingItem = cart.find(item => item.productId === productId);
            
            if (existingItem) {
                if (existingItem.quantity >= product.stock) {
                    alert('Stok tidak mencukupi!');
                    return;
                }
                existingItem.quantity++;
            } else {
                cart.push({
                    productId: productId,
                    name: product.name,
                    price: product.sellPrice,
                    quantity: 1
                });
            }
            
            renderCart();
            updatePaymentSummary();
        }

        function renderCart() {
            const tbody = document.getElementById('cart-items');
            
            if (cart.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">Keranjang kosong</td></tr>';
                return;
            }
            
            tbody.innerHTML = cart.map((item, index) => `
                <tr class="border-b border-gray-100">
                    <td class="py-3 px-2">
                        <div class="font-semibold text-gray-800">${item.name}</div>
                    </td>
                    <td class="py-3 px-2">${formatCurrency(item.price)}</td>
                    <td class="py-3 px-2">
                        <div class="flex items-center space-x-2">
                            <button onclick="updateQuantity(${index}, -1)" class="bg-red-500 text-white w-6 h-6 rounded text-sm hover:bg-red-600">-</button>
                            <span class="font-semibold">${item.quantity}</span>
                            <button onclick="updateQuantity(${index}, 1)" class="bg-green-500 text-white w-6 h-6 rounded text-sm hover:bg-green-600">+</button>
                        </div>
                    </td>
                    <td class="py-3 px-2 font-semibold">${formatCurrency(item.price * item.quantity)}</td>
                    <td class="py-3 px-2">
                        <button onclick="removeFromCart(${index})" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600">
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function updateQuantity(index, change) {
            const item = cart[index];
            const product = products.find(p => p.id === item.productId);
            
            const newQuantity = item.quantity + change;
            
            if (newQuantity <= 0) {
                removeFromCart(index);
                return;
            }
            
            if (newQuantity > product.stock) {
                alert('Stok tidak mencukupi!');
                return;
            }
            
            item.quantity = newQuantity;
            renderCart();
            updatePaymentSummary();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            renderCart();
            updatePaymentSummary();
        }

        function clearCart() {
            if (cart.length === 0) return;
            
            if (confirm('Kosongkan keranjang belanja?')) {
                cart = [];
                renderCart();
                updatePaymentSummary();
            }
        }

        function updatePaymentSummary() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const discount = 0; // Could be implemented later
            const tax = Math.round(subtotal * 0);
            const total = subtotal - discount + tax;
            
            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('discount').textContent = formatCurrency(discount);
            document.getElementById('tax').textContent = formatCurrency(tax);
            document.getElementById('total').textContent = formatCurrency(total);
            
            // Enable/disable process button
            const processBtn = document.getElementById('process-btn');
            processBtn.disabled = cart.length === 0;
            
            // Update change calculation
            updateChange();
        }

        function selectPaymentMethod(method) {
            currentPaymentMethod = method;
            
            // Update button styles
            document.querySelectorAll('.payment-method').forEach(btn => {
                btn.classList.remove('border-primary', 'bg-primary', 'text-white');
                btn.classList.add('border-gray-300');
            });
            
            event.target.classList.add('border-primary', 'bg-primary', 'text-white');
            event.target.classList.remove('border-gray-300');
            
            // Show/hide cash input
            const cashInput = document.getElementById('cash-input');
            cashInput.style.display = method === 'cash' ? 'block' : 'none';
        }

        function updateChange() {
            if (currentPaymentMethod !== 'cash') return;
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0) ;
            const cashAmount = parseFloat(document.getElementById('cash-amount').value) || 0;
            const change = Math.max(0, cashAmount - total);
            
            document.getElementById('change').textContent = formatCurrency(change);
        }

        document.getElementById('cash-amount').addEventListener('input', updateChange);

        function processPayment() {
            if (cart.length === 0) {
                alert('Keranjang kosong!');
                return;
            }
            
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = Math.round(subtotal * 0);
            const total = subtotal + tax;
            
            if (currentPaymentMethod === 'cash') {
                const cashAmount = parseFloat(document.getElementById('cash-amount').value) || 0;
                if (cashAmount < total) {
                    alert('Jumlah bayar kurang!');
                    return;
                }
            }
            
            // Get selected customer
            const selectedCustomerId = document.getElementById('customer-select').value;
            const selectedCustomer = selectedCustomerId ? customers.find(c => c.id == selectedCustomerId) : null;
            
            // Calculate cost and profit for each item
            const itemsWithCost = cart.map(item => {
                const product = products.find(p => p.id === item.productId);
                const cost = product ? product.buyPrice * item.quantity : 0;
                const profit = (item.price - (product ? product.buyPrice : 0)) * item.quantity;
                
                return {
                    ...item,
                    cost: cost,
                    profit: profit
                };
            });
            
            const totalCost = itemsWithCost.reduce((sum, item) => sum + item.cost, 0);
            const totalProfit = itemsWithCost.reduce((sum, item) => sum + item.profit, 0);
            
            // Create transaction
            const transaction = {
                id: transactions.length + 1,
                invoice: `INV/${new Date().toISOString().slice(0, 10).replace(/-/g, '')}/${String(invoiceCounter).padStart(3, '0')}`,
                date: new Date().toISOString(),
                customerId: selectedCustomer ? selectedCustomer.id : null,
                customerName: selectedCustomer ? selectedCustomer.name : 'Pelanggan Umum',
                items: itemsWithCost,
                subtotal: subtotal,
                tax: tax,
                total: total,
                totalCost: totalCost,
                totalProfit: totalProfit,
                paymentMethod: currentPaymentMethod,
                cashAmount: currentPaymentMethod === 'cash' ? parseFloat(document.getElementById('cash-amount').value) : total,
                change: currentPaymentMethod === 'cash' ? Math.max(0, parseFloat(document.getElementById('cash-amount').value) - total) : 0
            };
            
            transactions.push(transaction);
            invoiceCounter++;
            
            // Update customer data if selected
            if (selectedCustomer) {
                selectedCustomer.totalSpent += total;
                selectedCustomer.lastPurchase = new Date().toISOString();
                // Add points (1 point per 10,000 rupiah)
                const pointsEarned = Math.floor(total / 10000);
                selectedCustomer.points += pointsEarned;
                
                // Update customer stats
                updateCustomerStats();
                renderCustomers();
            }
            
            // Update product stock
            cart.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if (product) {
                    product.stock -= item.quantity;
                }
            });
            
            // Show receipt
            showReceipt(transaction);
            
            // Clear cart and reset customer selection
            cart = [];
            document.getElementById('customer-select').value = '';
            renderCart();
            updatePaymentSummary();
            renderProducts();
            updateDashboard();
            
            // Reset cash input
            document.getElementById('cash-amount').value = '';
        }

        function showReceipt(transaction) {
            const modal = document.getElementById('receipt-modal');
            const content = document.getElementById('receipt-content');
            
            content.innerHTML = `
                <div class="text-center mb-4">
                    <div class="w-12 h-12 bg-primary rounded-full mx-auto mb-2 flex items-center justify-center">
                        <span class="text-white font-bold">${storeSettings.name.split(' ').map(w => w[0]).join('').substring(0, 2)}</span>
                    </div>
                    <h3 class="font-montserrat font-bold text-lg">${storeSettings.name.toUpperCase()}</h3>
                    <p class="text-xs text-gray-600">${storeSettings.address}</p>
                    <p class="text-xs text-gray-600">Telp: ${storeSettings.phone}</p>
                    ${storeSettings.email ? `<p class="text-xs text-gray-600">${storeSettings.email}</p>` : ''}
                </div>

                <div class="border-t border-dashed border-gray-400 my-3"></div>

                <div class="text-xs space-y-1 mb-3">
                    <div class="flex justify-between">
                        <span>Invoice:</span>
                        <span class="font-semibold">${transaction.invoice}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Pelanggan:</span>
                        <span class="font-semibold">${transaction.customerName || 'Pelanggan Umum'}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Kasir:</span>
                        <span>Admin</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Waktu:</span>
                        <span>${new Date(transaction.date).toLocaleString('id-ID')}</span>
                    </div>
                </div>

                <div class="border-t border-dashed border-gray-400 my-3"></div>

                <div class="text-xs space-y-2 mb-3">
                    ${transaction.items.map(item => `
                        <div class="flex justify-between">
                            <div>
                                <p class="font-semibold">${item.name}</p>
                                <p class="text-gray-600">${item.quantity} x ${formatCurrency(item.price)}</p>
                            </div>
                            <span class="font-semibold">${formatCurrency(item.price * item.quantity)}</span>
                        </div>
                    `).join('')}
                </div>

                <div class="border-t border-dashed border-gray-400 my-3"></div>

                <div class="text-xs space-y-1 mb-3">
                    <div class="flex justify-between">
                        <span>Subtotal:</span>
                        <span>${formatCurrency(transaction.subtotal)}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>PPN 11%:</span>
                        <span>${formatCurrency(transaction.tax)}</span>
                    </div>
                    <div class="flex justify-between font-bold text-sm">
                        <span>TOTAL:</span>
                        <span>${formatCurrency(transaction.total)}</span>
                    </div>
                    ${transaction.paymentMethod === 'cash' ? `
                        <div class="flex justify-between">
                            <span>Cash:</span>
                            <span>${formatCurrency(transaction.cashAmount)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Kembalian:</span>
                            <span>${formatCurrency(transaction.change)}</span>
                        </div>
                    ` : ''}
                </div>

                <div class="border-t border-dashed border-gray-400 my-3"></div>

                <div class="text-center">
                    <div class="w-16 h-16 bg-gray-800 mx-auto mb-2 flex items-center justify-center">
                        <div class="grid grid-cols-4 gap-px">
                            ${Array(16).fill().map(() => `<div class="w-1 h-1 bg-${Math.random() > 0.5 ? 'white' : 'gray-800'}"></div>`).join('')}
                        </div>
                    </div>
                    <p class="text-xs font-semibold">TERIMA KASIH</p>
                    <p class="text-xs text-gray-600">Barang yang sudah dibeli</p>
                    <p class="text-xs text-gray-600">tidak dapat dikembalikan</p>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function hideReceiptModal() {
            document.getElementById('receipt-modal').classList.add('hidden');
        }

        function printReceipt() {
            const content = document.getElementById('receipt-content').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Struk Pembayaran</title>
                        <style>
                            body { font-family: monospace; font-size: 12px; margin: 20px; }
                            .text-center { text-align: center; }
                            .font-bold { font-weight: bold; }
                            .text-xs { font-size: 10px; }
                            .text-sm { font-size: 11px; }
                            .mb-2 { margin-bottom: 8px; }
                            .mb-3 { margin-bottom: 12px; }
                            .mb-4 { margin-bottom: 16px; }
                            .space-y-1 > * + * { margin-top: 4px; }
                            .space-y-2 > * + * { margin-top: 8px; }
                            .flex { display: flex; }
                            .justify-between { justify-content: space-between; }
                            .border-t { border-top: 1px dashed #666; }
                            .my-3 { margin: 12px 0; }
                        </style>
                    </head>
                    <body>${content}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function holdTransaction() {
            if (cart.length === 0) {
                alert('Keranjang kosong!');
                return;
            }
            
            // In a real app, you'd save this to localStorage or server
            alert('Transaksi ditahan. Fitur ini akan menyimpan transaksi untuk dilanjutkan nanti.');
        }

        // Reports Functions
        function generateReport() {
            const startDateValue = document.getElementById('report-start-date').value;
            const endDateValue = document.getElementById('report-end-date').value;
            const category = document.getElementById('report-category').value;
            
            if (!startDateValue || !endDateValue) {
                alert('Silakan pilih tanggal mulai dan tanggal akhir!');
                return;
            }
            
            const startDate = new Date(startDateValue + 'T00:00:00');
            const endDate = new Date(endDateValue + 'T23:59:59');
            
            console.log('Generating report from', startDate, 'to', endDate);
            console.log('Total transactions:', transactions.length);
            
            let filteredTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                const isInRange = transactionDate >= startDate && transactionDate <= endDate;
                console.log('Transaction date:', transactionDate, 'In range:', isInRange);
                return isInRange;
            });
            
            console.log('Filtered transactions:', filteredTransactions.length);
            
            if (category) {
                filteredTransactions = filteredTransactions.filter(t => 
                    t.items.some(item => {
                        const product = products.find(p => p.id === item.productId);
                        return product && product.category === category;
                    })
                );
                console.log('After category filter:', filteredTransactions.length);
            }
            
            // Calculate financial metrics
            const totalSales = filteredTransactions.reduce((sum, t) => sum + t.total, 0);
            const totalCost = filteredTransactions.reduce((sum, t) => sum + (t.totalCost || 0), 0);
            const totalProfit = filteredTransactions.reduce((sum, t) => sum + (t.totalProfit || 0), 0);
            const totalTransactions = filteredTransactions.length;
            const profitMargin = totalSales > 0 ? (totalProfit / totalSales * 100) : 0;
            
            // Update summary display
            document.getElementById('report-total-sales').textContent = formatCurrency(totalSales);
            document.getElementById('report-total-transactions').textContent = totalTransactions;
            document.getElementById('report-total-cost').textContent = formatCurrency(totalCost);
            document.getElementById('report-total-profit').textContent = formatCurrency(totalProfit);
            document.getElementById('report-profit-margin').textContent = profitMargin.toFixed(1) + '%';
            
            // Store current report data
            currentReportData = {
                totalSales: totalSales,
                totalCost: totalCost,
                totalProfit: totalProfit,
                totalTransactions: totalTransactions,
                profitMargin: profitMargin,
                transactions: filteredTransactions
            };
            
            // Update table
            renderReportTransactions(filteredTransactions);
            
            // Show success message
            if (filteredTransactions.length > 0) {
                alert(`Laporan berhasil di-generate! Ditemukan ${totalTransactions} transaksi dengan total penjualan ${formatCurrency(totalSales)}`);
            } else {
                alert('Tidak ada transaksi dalam periode yang dipilih.');
            }
        }

        function renderReportTransactions(transactions) {
            const tbody = document.getElementById('report-transactions');
            
            if (transactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center py-8 text-gray-500">Tidak ada transaksi dalam periode ini</td></tr>';
                return;
            }
            
            tbody.innerHTML = transactions.map(transaction => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4 font-semibold">${transaction.invoice}</td>
                    <td class="py-3 px-4">
                        <div>${new Date(transaction.date).toLocaleDateString('id-ID')}</div>
                        <div class="text-xs text-gray-600">${transaction.customerName || 'Pelanggan Umum'}</div>
                    </td>
                    <td class="py-3 px-4">${transaction.items.length} items</td>
                    <td class="py-3 px-4 text-red-600 font-semibold">${formatCurrency(transaction.totalCost || 0)}</td>
                    <td class="py-3 px-4 text-blue-600 font-semibold">${formatCurrency(transaction.total)}</td>
                    <td class="py-3 px-4 text-green-600 font-semibold">${formatCurrency(transaction.totalProfit || 0)}</td>
                    <td class="py-3 px-4">
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold">
                            ${transaction.paymentMethod}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <button onclick="viewTransactionDetail('${transaction.invoice}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors">
                            üëÅÔ∏è Detail
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function viewTransactionDetail(invoice) {
            const transaction = transactions.find(t => t.invoice === invoice);
            if (!transaction) return;
            
            const content = document.getElementById('transaction-detail-content');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- Transaction Info -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-3">Informasi Transaksi</h4>
                        <div class="space-y-2 text-sm">
                            <div><span class="font-semibold">Invoice:</span> ${transaction.invoice}</div>
                            <div><span class="font-semibold">Tanggal:</span> ${new Date(transaction.date).toLocaleDateString('id-ID')}</div>
                            <div><span class="font-semibold">Waktu:</span> ${new Date(transaction.date).toLocaleTimeString('id-ID')}</div>
                            <div><span class="font-semibold">Pelanggan:</span> ${transaction.customerName || 'Pelanggan Umum'}</div>
                            <div><span class="font-semibold">Pembayaran:</span> 
                                <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold">
                                    ${transaction.paymentMethod}
                                </span>
                            </div>
                            ${transaction.paymentMethod === 'cash' ? `
                                <div><span class="font-semibold">Bayar:</span> ${formatCurrency(transaction.cashAmount || 0)}</div>
                                <div><span class="font-semibold">Kembalian:</span> ${formatCurrency(transaction.change || 0)}</div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- Financial Summary -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-3">Ringkasan Keuangan</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="font-semibold">Subtotal:</span>
                                <span class="text-blue-600 font-bold">${formatCurrency(transaction.subtotal || 0)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-semibold">PPN 11%:</span>
                                <span class="text-gray-600">${formatCurrency(transaction.tax || 0)}</span>
                            </div>
                            <div class="flex justify-between border-t pt-2">
                                <span class="font-semibold">Total Penjualan:</span>
                                <span class="text-green-600 font-bold">${formatCurrency(transaction.total)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-semibold">Total Modal:</span>
                                <span class="text-red-600 font-bold">${formatCurrency(transaction.totalCost || 0)}</span>
                            </div>
                            <div class="flex justify-between border-t pt-2">
                                <span class="font-semibold">Total Profit:</span>
                                <span class="text-purple-600 font-bold">${formatCurrency(transaction.totalProfit || 0)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-semibold">Margin Profit:</span>
                                <span class="text-orange-600 font-bold">${transaction.total > 0 ? ((transaction.totalProfit || 0) / transaction.total * 100).toFixed(1) : 0}%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Items Detail -->
                <div class="bg-white border rounded-lg mb-6">
                    <div class="p-4 border-b bg-gray-50">
                        <h4 class="font-semibold text-gray-800">Detail Produk yang Dibeli</h4>
                        <p class="text-sm text-gray-600">${transaction.items.length} item dalam transaksi ini</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Produk</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Harga Satuan</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Qty</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Subtotal</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Modal</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Profit</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Margin</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${transaction.items.map(item => {
                                    const subtotal = item.price * item.quantity;
                                    const itemCost = item.cost || 0;
                                    const itemProfit = item.profit || 0;
                                    const itemMargin = subtotal > 0 ? (itemProfit / subtotal * 100).toFixed(1) : 0;
                                    
                                    return `
                                        <tr class="border-b border-gray-100">
                                            <td class="py-3 px-4">
                                                <div class="font-semibold text-gray-800">${item.name}</div>
                                                <div class="text-xs text-gray-500">ID: ${item.productId}</div>
                                            </td>
                                            <td class="py-3 px-4 font-semibold text-blue-600">${formatCurrency(item.price)}</td>
                                            <td class="py-3 px-4">
                                                <span class="bg-gray-100 px-2 py-1 rounded-full text-sm font-semibold">${item.quantity}</span>
                                            </td>
                                            <td class="py-3 px-4 font-semibold text-green-600">${formatCurrency(subtotal)}</td>
                                            <td class="py-3 px-4 font-semibold text-red-600">${formatCurrency(itemCost)}</td>
                                            <td class="py-3 px-4 font-semibold text-purple-600">${formatCurrency(itemProfit)}</td>
                                            <td class="py-3 px-4">
                                                <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-semibold">
                                                    ${itemMargin}%
                                                </span>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                            <tfoot class="bg-gray-50">
                                <tr>
                                    <td colspan="3" class="py-3 px-4 font-bold text-gray-800">TOTAL</td>
                                    <td class="py-3 px-4 font-bold text-green-600">${formatCurrency(transaction.total)}</td>
                                    <td class="py-3 px-4 font-bold text-red-600">${formatCurrency(transaction.totalCost || 0)}</td>
                                    <td class="py-3 px-4 font-bold text-purple-600">${formatCurrency(transaction.totalProfit || 0)}</td>
                                    <td class="py-3 px-4">
                                        <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-bold">
                                            ${transaction.total > 0 ? ((transaction.totalProfit || 0) / transaction.total * 100).toFixed(1) : 0}%
                                        </span>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="flex justify-end space-x-3">
                    <button onclick="printTransactionDetail('${transaction.invoice}')" class="bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                        üñ®Ô∏è Print Detail
                    </button>
                    <button onclick="hideTransactionDetailModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                        ‚úÖ Tutup
                    </button>
                </div>
            `;
            
            document.getElementById('transaction-detail-modal').classList.remove('hidden');
        }

        function hideTransactionDetailModal() {
            document.getElementById('transaction-detail-modal').classList.add('hidden');
        }

        function printTransactionDetail(invoice) {
            const transaction = transactions.find(t => t.invoice === invoice);
            if (!transaction) return;
            
            const printWindow = window.open('', '_blank');
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Detail Transaksi ${invoice}</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            font-size: 12px;
                            line-height: 1.4;
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 30px; 
                            border-bottom: 2px solid #333;
                            padding-bottom: 20px;
                        }
                        .store-name { 
                            font-size: 24px; 
                            font-weight: bold; 
                            margin-bottom: 5px;
                        }
                        .store-info { 
                            font-size: 12px; 
                            color: #666; 
                            margin-bottom: 3px;
                        }
                        .transaction-title { 
                            font-size: 18px; 
                            font-weight: bold; 
                            margin: 20px 0 10px 0;
                        }
                        .info-box { 
                            border: 1px solid #333; 
                            padding: 15px; 
                            margin: 20px 0;
                            background-color: #f9f9f9;
                        }
                        .info-row { 
                            display: flex; 
                            justify-content: space-between; 
                            margin-bottom: 5px;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 20px;
                            font-size: 10px;
                        }
                        th, td { 
                            border: 1px solid #333; 
                            padding: 8px; 
                            text-align: left;
                        }
                        th { 
                            background-color: #f0f0f0; 
                            font-weight: bold;
                        }
                        .text-right { text-align: right; }
                        .footer { 
                            margin-top: 30px; 
                            text-align: center; 
                            font-size: 10px; 
                            color: #666;
                            border-top: 1px solid #ccc;
                            padding-top: 10px;
                        }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="store-name">${storeSettings.name.toUpperCase()}</div>
                        <div class="store-info">${storeSettings.address}</div>
                        <div class="store-info">Telp: ${storeSettings.phone}</div>
                        ${storeSettings.email ? `<div class="store-info">Email: ${storeSettings.email}</div>` : ''}
                    </div>

                    <div class="transaction-title">DETAIL TRANSAKSI ${transaction.invoice}</div>
                    
                    <div class="info-box">
                        <div class="info-row">
                            <span>Tanggal:</span>
                            <span><strong>${new Date(transaction.date).toLocaleString('id-ID')}</strong></span>
                        </div>
                        <div class="info-row">
                            <span>Pelanggan:</span>
                            <span><strong>${transaction.customerName || 'Pelanggan Umum'}</strong></span>
                        </div>
                        <div class="info-row">
                            <span>Pembayaran:</span>
                            <span><strong>${transaction.paymentMethod}</strong></span>
                        </div>
                        ${transaction.paymentMethod === 'cash' ? `
                            <div class="info-row">
                                <span>Bayar:</span>
                                <span><strong>${formatCurrency(transaction.cashAmount || 0)}</strong></span>
                            </div>
                            <div class="info-row">
                                <span>Kembalian:</span>
                                <span><strong>${formatCurrency(transaction.change || 0)}</strong></span>
                            </div>
                        ` : ''}
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Produk</th>
                                <th>Harga</th>
                                <th>Qty</th>
                                <th>Subtotal</th>
                                <th>Modal</th>
                                <th>Profit</th>
                                <th>Margin</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${transaction.items.map(item => {
                                const subtotal = item.price * item.quantity;
                                const itemCost = item.cost || 0;
                                const itemProfit = item.profit || 0;
                                const itemMargin = subtotal > 0 ? (itemProfit / subtotal * 100).toFixed(1) : 0;
                                
                                return `
                                    <tr>
                                        <td>${item.name}</td>
                                        <td class="text-right">${formatCurrency(item.price)}</td>
                                        <td class="text-right">${item.quantity}</td>
                                        <td class="text-right">${formatCurrency(subtotal)}</td>
                                        <td class="text-right">${formatCurrency(itemCost)}</td>
                                        <td class="text-right">${formatCurrency(itemProfit)}</td>
                                        <td class="text-right">${itemMargin}%</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                        <tfoot>
                            <tr style="background-color: #f0f0f0; font-weight: bold;">
                                <td colspan="3">TOTAL</td>
                                <td class="text-right">${formatCurrency(transaction.total)}</td>
                                <td class="text-right">${formatCurrency(transaction.totalCost || 0)}</td>
                                <td class="text-right">${formatCurrency(transaction.totalProfit || 0)}</td>
                                <td class="text-right">${transaction.total > 0 ? ((transaction.totalProfit || 0) / transaction.total * 100).toFixed(1) : 0}%</td>
                            </tr>
                        </tfoot>
                    </table>

                    <div class="info-box" style="margin-top: 30px;">
                        <div class="info-row">
                            <span>Subtotal:</span>
                            <span><strong>${formatCurrency(transaction.subtotal || 0)}</strong></span>
                        </div>
                        <div class="info-row">
                            <span>PPN 11%:</span>
                            <span><strong>${formatCurrency(transaction.tax || 0)}</strong></span>
                        </div>
                        <div class="info-row" style="border-top: 1px solid #333; padding-top: 5px; margin-top: 5px;">
                            <span>TOTAL PENJUALAN:</span>
                            <span><strong>${formatCurrency(transaction.total)}</strong></span>
                        </div>
                        <div class="info-row">
                            <span>TOTAL MODAL:</span>
                            <span><strong>${formatCurrency(transaction.totalCost || 0)}</strong></span>
                        </div>
                        <div class="info-row">
                            <span>TOTAL PROFIT:</span>
                            <span><strong>${formatCurrency(transaction.totalProfit || 0)}</strong></span>
                        </div>
                        <div class="info-row">
                            <span>MARGIN PROFIT:</span>
                            <span><strong>${transaction.total > 0 ? ((transaction.totalProfit || 0) / transaction.total * 100).toFixed(1) : 0}%</strong></span>
                        </div>
                    </div>

                    <div class="footer">
                        <div>Dicetak pada: ${new Date().toLocaleString('id-ID')}</div>
                        <div>Sistem POS - ${storeSettings.name}</div>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
        }

        // Report Management Functions
        let currentReportData = null;

        function loadSavedReports() {
            const saved = localStorage.getItem('pos_reports');
            if (saved) {
                reports = JSON.parse(saved);
            }
        }

        function saveReportsToStorage() {
            localStorage.setItem('pos_reports', JSON.stringify(reports));
        }

        function renderSavedReports() {
            const tbody = document.getElementById('saved-reports');
            
            if (reports.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">Belum ada laporan tersimpan</td></tr>';
                return;
            }
            
            tbody.innerHTML = reports.map(report => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4">
                        <div class="font-semibold text-gray-800">${report.name}</div>
                        ${report.description ? `<div class="text-sm text-gray-600">${report.description}</div>` : ''}
                    </td>
                    <td class="py-3 px-4">${report.period}</td>
                    <td class="py-3 px-4 font-semibold text-success">${formatCurrency(report.totalSales)}</td>
                    <td class="py-3 px-4">${report.totalTransactions}</td>
                    <td class="py-3 px-4 text-sm text-gray-600">${new Date(report.createdAt).toLocaleDateString('id-ID')}</td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button onclick="printReport('${report.id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors">
                                üìÑ Print PDF
                            </button>
                            <button onclick="viewSavedReport('${report.id}')" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors">
                                üëÅÔ∏è Lihat
                            </button>
                            <button onclick="deleteSavedReport('${report.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors">
                                üóëÔ∏è Hapus
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function saveCurrentReport() {
            if (!currentReportData) {
                alert('Tidak ada data laporan untuk disimpan. Silakan generate laporan terlebih dahulu.');
                return;
            }
            
            // Pre-fill modal with current report data
            const startDate = document.getElementById('report-start-date').value;
            const endDate = document.getElementById('report-end-date').value;
            const category = document.getElementById('report-category').value;
            
            const period = startDate === endDate ? 
                new Date(startDate).toLocaleDateString('id-ID') : 
                `${new Date(startDate).toLocaleDateString('id-ID')} - ${new Date(endDate).toLocaleDateString('id-ID')}`;
            
            document.getElementById('save-period').textContent = period + (category ? ` (${category})` : '');
            document.getElementById('save-total-sales').textContent = formatCurrency(currentReportData.totalSales);
            document.getElementById('save-total-cost').textContent = formatCurrency(currentReportData.totalCost);
            document.getElementById('save-total-profit').textContent = formatCurrency(currentReportData.totalProfit);
            document.getElementById('save-total-transactions').textContent = currentReportData.totalTransactions;
            
            // Auto-generate report name
            const today = new Date().toLocaleDateString('id-ID');
            document.getElementById('report-name').value = `Laporan Penjualan ${period}`;
            
            document.getElementById('save-report-modal').classList.remove('hidden');
        }

        function hideSaveReportModal() {
            document.getElementById('save-report-modal').classList.add('hidden');
            document.getElementById('save-report-form').reset();
        }

        document.getElementById('save-report-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const reportName = document.getElementById('report-name').value;
            const reportDescription = document.getElementById('report-description').value;
            
            const savedReport = {
                id: 'report_' + Date.now(),
                name: reportName,
                description: reportDescription,
                period: document.getElementById('save-period').textContent,
                totalSales: currentReportData.totalSales,
                totalCost: currentReportData.totalCost,
                totalProfit: currentReportData.totalProfit,
                totalTransactions: currentReportData.totalTransactions,
                profitMargin: currentReportData.profitMargin,
                transactions: currentReportData.transactions,
                filters: {
                    startDate: document.getElementById('report-start-date').value,
                    endDate: document.getElementById('report-end-date').value,
                    category: document.getElementById('report-category').value
                },
                createdAt: new Date().toISOString()
            };
            
            reports.push(savedReport);
            saveReportsToStorage();
            renderSavedReports();
            hideSaveReportModal();
            
            alert('Laporan berhasil disimpan!');
        });

        function viewSavedReport(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) {
                alert('Laporan tidak ditemukan!');
                return;
            }
            
            // Set the filters to match the saved report
            if (report.filters) {
                document.getElementById('report-start-date').value = report.filters.startDate || '';
                document.getElementById('report-end-date').value = report.filters.endDate || '';
                document.getElementById('report-category').value = report.filters.category || '';
            }
            
            // Update summary
            document.getElementById('report-total-sales').textContent = formatCurrency(report.totalSales || 0);
            document.getElementById('report-total-transactions').textContent = report.totalTransactions || 0;
            document.getElementById('report-total-cost').textContent = formatCurrency(report.totalCost || 0);
            document.getElementById('report-total-profit').textContent = formatCurrency(report.totalProfit || 0);
            document.getElementById('report-profit-margin').textContent = (report.profitMargin || 0).toFixed(1) + '%';
            
            // Update current report data
            currentReportData = {
                totalSales: report.totalSales || 0,
                totalCost: report.totalCost || 0,
                totalProfit: report.totalProfit || 0,
                totalTransactions: report.totalTransactions || 0,
                profitMargin: report.profitMargin || 0,
                transactions: report.transactions || []
            };
            
            // Render transactions
            renderReportTransactions(report.transactions || []);
            
            // Show success message with report details
            const reportDetails = `üìä LAPORAN: ${report.name}\n\n` +
                `üìÖ Periode: ${report.period}\n` +
                `üí∞ Total Penjualan: ${formatCurrency(report.totalSales || 0)}\n` +
                `üìà Total Profit: ${formatCurrency(report.totalProfit || 0)}\n` +
                `üõí Jumlah Transaksi: ${report.totalTransactions || 0}\n` +
                `üìä Margin Profit: ${(report.profitMargin || 0).toFixed(1)}%\n\n` +
                `‚úÖ Laporan berhasil ditampilkan!`;
            
            alert(reportDetails);
        }

        function printReport(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;
            
            generatePrintableReport(report);
        }

        function generatePrintableReport(reportData) {
            // Create a new window with print-friendly content
            const printWindow = window.open('', '_blank', 'width=800,height=600');
            
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${reportData.name}</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            font-size: 12px;
                            line-height: 1.4;
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 30px; 
                            border-bottom: 2px solid #333;
                            padding-bottom: 20px;
                        }
                        .store-name { 
                            font-size: 24px; 
                            font-weight: bold; 
                            margin-bottom: 5px;
                        }
                        .store-info { 
                            font-size: 12px; 
                            color: #666; 
                            margin-bottom: 3px;
                        }
                        .report-title { 
                            font-size: 18px; 
                            font-weight: bold; 
                            margin: 20px 0 10px 0;
                        }
                        .summary-box { 
                            border: 1px solid #333; 
                            padding: 15px; 
                            margin: 20px 0;
                            background-color: #f9f9f9;
                        }
                        .summary-title { 
                            font-size: 14px; 
                            font-weight: bold; 
                            margin-bottom: 10px;
                        }
                        .summary-row { 
                            display: flex; 
                            justify-content: space-between; 
                            margin-bottom: 5px;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 20px;
                            font-size: 10px;
                        }
                        th, td { 
                            border: 1px solid #333; 
                            padding: 8px; 
                            text-align: left;
                        }
                        th { 
                            background-color: #f0f0f0; 
                            font-weight: bold;
                        }
                        .text-right { text-align: right; }
                        .footer { 
                            margin-top: 30px; 
                            text-align: center; 
                            font-size: 10px; 
                            color: #666;
                            border-top: 1px solid #ccc;
                            padding-top: 10px;
                        }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                        .print-button {
                            background: #2563EB;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 5px;
                            cursor: pointer;
                            font-size: 14px;
                            margin: 20px 0;
                        }
                        .print-button:hover {
                            background: #1d4ed8;
                        }
                    </style>
                </head>
                <body>
                    <div class="no-print">
                        <button class="print-button" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
                    </div>
                    
                    <div class="header">
                        <div class="store-name">${storeSettings.name.toUpperCase()}</div>
                        <div class="store-info">${storeSettings.address}</div>
                        <div class="store-info">Telp: ${storeSettings.phone}</div>
                        ${storeSettings.email ? `<div class="store-info">Email: ${storeSettings.email}</div>` : ''}
                        ${storeSettings.npwp ? `<div class="store-info">NPWP: ${storeSettings.npwp}</div>` : ''}
                    </div>

                    <div class="report-title">${reportData.name}</div>
                    <div class="store-info">Periode: ${reportData.period}</div>
                    <div class="store-info">Dibuat: ${new Date(reportData.createdAt).toLocaleString('id-ID')}</div>

                    <div class="summary-box">
                        <div class="summary-title">RINGKASAN LAPORAN</div>
                        <div class="summary-row">
                            <span>Total Penjualan:</span>
                            <span><strong>${formatCurrency(reportData.totalSales)}</strong></span>
                        </div>
                        <div class="summary-row">
                            <span>Total Modal:</span>
                            <span><strong>${formatCurrency(reportData.totalCost || 0)}</strong></span>
                        </div>
                        <div class="summary-row">
                            <span>Total Profit:</span>
                            <span><strong>${formatCurrency(reportData.totalProfit || 0)}</strong></span>
                        </div>
                        <div class="summary-row">
                            <span>Margin Profit:</span>
                            <span><strong>${(reportData.profitMargin || 0).toFixed(1)}%</strong></span>
                        </div>
                        <div class="summary-row">
                            <span>Jumlah Transaksi:</span>
                            <span><strong>${reportData.totalTransactions}</strong></span>
                        </div>
                    </div>

                    ${reportData.transactions && reportData.transactions.length > 0 ? `
                        <table>
                            <thead>
                                <tr>
                                    <th>Invoice</th>
                                    <th>Tanggal</th>
                                    <th>Pelanggan</th>
                                    <th>Items</th>
                                    <th>Modal</th>
                                    <th>Penjualan</th>
                                    <th>Profit</th>
                                    <th>Margin</th>
                                    <th>Pembayaran</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${reportData.transactions.map(t => {
                                    const margin = t.total > 0 ? ((t.totalProfit || 0) / t.total * 100).toFixed(1) : '0';
                                    return `
                                        <tr>
                                            <td>${t.invoice}</td>
                                            <td>${new Date(t.date).toLocaleDateString('id-ID')}</td>
                                            <td>${t.customerName || 'Pelanggan Umum'}</td>
                                            <td>${t.items.length} items</td>
                                            <td class="text-right">${formatCurrency(t.totalCost || 0)}</td>
                                            <td class="text-right">${formatCurrency(t.total)}</td>
                                            <td class="text-right">${formatCurrency(t.totalProfit || 0)}</td>
                                            <td class="text-right">${margin}%</td>
                                            <td>${t.paymentMethod}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    ` : ''}

                    <div class="footer">
                        <div>Dicetak pada: ${new Date().toLocaleString('id-ID')}</div>
                        <div>Sistem POS - ${storeSettings.name}</div>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
        }

        function deleteSavedReport(reportId) {
            if (confirm('Apakah Anda yakin ingin menghapus laporan ini?')) {
                reports = reports.filter(r => r.id !== reportId);
                saveReportsToStorage();
                renderSavedReports();
                alert('Laporan berhasil dihapus!');
            }
        }

        function clearReportHistory() {
            if (reports.length === 0) {
                alert('Tidak ada laporan untuk dihapus.');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus semua laporan tersimpan?')) {
                reports = [];
                saveReportsToStorage();
                renderSavedReports();
                alert('Semua laporan berhasil dihapus!');
            }
        }

        function exportReportExcel() {
            if (!currentReportData) {
                alert('Tidak ada data laporan untuk di-export. Silakan generate laporan terlebih dahulu.');
                return;
            }
            
            // Create CSV content for Excel
            let csvContent = 'LAPORAN PENJUALAN\n';
            csvContent += `Toko: ${storeSettings.name}\n`;
            csvContent += `Alamat: ${storeSettings.address}\n`;
            csvContent += `Telepon: ${storeSettings.phone}\n`;
            csvContent += `Periode: ${document.getElementById('report-start-date').value} - ${document.getElementById('report-end-date').value}\n`;
            csvContent += `Dibuat: ${new Date().toLocaleString('id-ID')}\n\n`;
            
            // Summary
            csvContent += 'RINGKASAN LAPORAN\n';
            csvContent += `Total Penjualan,${formatCurrency(currentReportData.totalSales)}\n`;
            csvContent += `Total Modal,${formatCurrency(currentReportData.totalCost)}\n`;
            csvContent += `Total Profit,${formatCurrency(currentReportData.totalProfit)}\n`;
            csvContent += `Margin Profit,${(currentReportData.profitMargin || 0).toFixed(1)}%\n`;
            csvContent += `Jumlah Transaksi,${currentReportData.totalTransactions}\n\n`;
            
            // Transaction details header
            csvContent += 'DETAIL TRANSAKSI\n';
            csvContent += 'Invoice,Tanggal,Waktu,Pelanggan,Items,Modal,Penjualan,Profit,Margin,Pembayaran\n';
            
            // Transaction data
            currentReportData.transactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const margin = transaction.total > 0 ? ((transaction.totalProfit || 0) / transaction.total * 100).toFixed(1) : '0';
                
                csvContent += `${transaction.invoice},`;
                csvContent += `${date.toLocaleDateString('id-ID')},`;
                csvContent += `${date.toLocaleTimeString('id-ID')},`;
                csvContent += `"${transaction.customerName || 'Pelanggan Umum'}",`;
                csvContent += `${transaction.items.length} items,`;
                csvContent += `${transaction.totalCost || 0},`;
                csvContent += `${transaction.total},`;
                csvContent += `${transaction.totalProfit || 0},`;
                csvContent += `${margin}%,`;
                csvContent += `${transaction.paymentMethod}\n`;
            });
            
            // Add item details
            csvContent += '\nDETAIL ITEM TERJUAL\n';
            csvContent += 'Invoice,Pelanggan,Produk,Harga,Qty,Subtotal,Modal,Profit\n';
            
            currentReportData.transactions.forEach(transaction => {
                transaction.items.forEach(item => {
                    csvContent += `${transaction.invoice},`;
                    csvContent += `"${transaction.customerName || 'Pelanggan Umum'}",`;
                    csvContent += `"${item.name}",`;
                    csvContent += `${item.price},`;
                    csvContent += `${item.quantity},`;
                    csvContent += `${item.price * item.quantity},`;
                    csvContent += `${item.cost || 0},`;
                    csvContent += `${item.profit || 0}\n`;
                });
            });
            
            // Download CSV file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            
            const startDate = document.getElementById('report-start-date').value;
            const endDate = document.getElementById('report-end-date').value;
            const fileName = `Laporan_Penjualan_${startDate}_${endDate}.csv`;
            
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('Laporan Excel berhasil didownload!\n\nFile dapat dibuka dengan:\n- Microsoft Excel\n- Google Sheets\n- LibreOffice Calc\n\nTips: Gunakan "Text to Columns" di Excel untuk memformat data dengan baik.');
        }

        function printDailyReport() {
            const today = new Date();
            const todayStr = today.toDateString();
            const todayTransactions = transactions.filter(t => new Date(t.date).toDateString() === todayStr);
            
            if (todayTransactions.length === 0) {
                alert('Tidak ada transaksi hari ini untuk dicetak.');
                return;
            }
            
            // Calculate daily statistics
            const totalSales = todayTransactions.reduce((sum, t) => sum + t.total, 0);
            const totalCost = todayTransactions.reduce((sum, t) => sum + (t.totalCost || 0), 0);
            const totalProfit = todayTransactions.reduce((sum, t) => sum + (t.totalProfit || 0), 0);
            const profitMargin = totalSales > 0 ? (totalProfit / totalSales * 100) : 0;
            
            // Create daily report data
            const dailyReportData = {
                name: `Laporan Harian - ${today.toLocaleDateString('id-ID')}`,
                period: today.toLocaleDateString('id-ID'),
                totalSales: totalSales,
                totalCost: totalCost,
                totalProfit: totalProfit,
                totalTransactions: todayTransactions.length,
                profitMargin: profitMargin,
                transactions: todayTransactions,
                createdAt: new Date().toISOString()
            };
            
            generatePrintableReport(dailyReportData);
        }

        function generatePDFReport(reportData) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(20);
            doc.setFont(undefined, 'bold');
            doc.text(storeSettings.name.toUpperCase(), 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text(storeSettings.address, 105, 30, { align: 'center' });
            doc.text(`Telp: ${storeSettings.phone}`, 105, 37, { align: 'center' });
            if (storeSettings.email) {
                doc.text(`Email: ${storeSettings.email}`, 105, 44, { align: 'center' });
            }
            
            // Report Title
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text(reportData.name, 105, 55, { align: 'center' });
            
            // Report Info
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Periode: ${reportData.period}`, 20, 70);
            doc.text(`Dibuat: ${new Date(reportData.createdAt).toLocaleString('id-ID')}`, 20, 77);
            
            // Summary Box
            doc.setDrawColor(0, 0, 0);
            doc.rect(20, 85, 170, 30);
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('RINGKASAN LAPORAN', 25, 95);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Total Penjualan: ${formatCurrency(reportData.totalSales)}`, 25, 105);
            doc.text(`Total Modal: ${formatCurrency(reportData.totalCost)}`, 100, 105);
            doc.text(`Total Profit: ${formatCurrency(reportData.totalProfit)}`, 25, 112);
            doc.text(`Margin Profit: ${(reportData.profitMargin || 0).toFixed(1)}%`, 100, 112);
            doc.text(`Jumlah Transaksi: ${reportData.totalTransactions}`, 25, 119);
            
            // Transactions Table
            if (reportData.transactions && reportData.transactions.length > 0) {
                const tableData = reportData.transactions.map(t => [
                    t.invoice,
                    new Date(t.date).toLocaleDateString('id-ID'),
                    t.items.length + ' items',
                    formatCurrency(t.totalCost || 0),
                    formatCurrency(t.total),
                    formatCurrency(t.totalProfit || 0),
                    t.paymentMethod
                ]);
                
                doc.autoTable({
                    head: [['Invoice', 'Tanggal', 'Items', 'Modal', 'Penjualan', 'Profit', 'Pembayaran']],
                    body: tableData,
                    startY: 130,
                    styles: { fontSize: 7 },
                    headStyles: { fillColor: [37, 99, 235] },
                    alternateRowStyles: { fillColor: [248, 250, 252] }
                });
            }
            
            // Footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.text(`Halaman ${i} dari ${pageCount}`, 105, 285, { align: 'center' });
                doc.text(`Dicetak pada: ${new Date().toLocaleString('id-ID')}`, 105, 290, { align: 'center' });
            }
            
            // Save PDF
            const fileName = `${reportData.name.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().slice(0, 10)}.pdf`;
            doc.save(fileName);
        }

        // Settings Functions
        function loadStoreSettings() {
            const saved = localStorage.getItem('pos_store_settings');
            if (saved) {
                storeSettings = { ...storeSettings, ...JSON.parse(saved) };
                updateStoreSettingsForm();
            }
        }

        function updateStoreSettingsForm() {
            document.getElementById('store-name').value = storeSettings.name;
            document.getElementById('store-owner').value = storeSettings.owner;
            document.getElementById('store-address').value = storeSettings.address;
            document.getElementById('store-phone').value = storeSettings.phone;
            document.getElementById('store-email').value = storeSettings.email;
            document.getElementById('store-npwp').value = storeSettings.npwp;
            document.getElementById('store-nib').value = storeSettings.nib;
        }

        function saveStoreSettings() {
            localStorage.setItem('pos_store_settings', JSON.stringify(storeSettings));
        }

        function playSuccessSound() {
            // Create a simple beep sound
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function exportAllData() {
            const data = {
                products: products,
                transactions: transactions,
                reports: reports,
                storeSettings: storeSettings,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pos_backup_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Data berhasil di-export!');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('Import data akan mengganti semua data yang ada. Lanjutkan?')) {
                            if (data.products) products = data.products;
                            if (data.transactions) transactions = data.transactions;
                            if (data.reports) reports = data.reports;
                            if (data.storeSettings) {
                                storeSettings = data.storeSettings;
                                updateStoreSettingsForm();
                                saveStoreSettings();
                            }
                            
                            // Update displays
                            renderProducts();
                            renderQuickProducts();
                            updateDashboard();
                            renderSavedReports();
                            
                            alert('Data berhasil di-import!');
                        }
                    } catch (error) {
                        alert('File tidak valid atau rusak!');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function resetAllData() {
            if (confirm('Apakah Anda yakin ingin menghapus SEMUA data? Tindakan ini tidak dapat dibatalkan!')) {
                if (confirm('Konfirmasi sekali lagi: SEMUA data produk, transaksi, dan laporan akan dihapus!')) {
                    products = [];
                    transactions = [];
                    reports = [];
                    cart = [];
                    invoiceCounter = 1;
                    
                    // Clear localStorage
                    localStorage.removeItem('pos_reports');
                    
                    // Update displays
                    renderProducts();
                    renderQuickProducts();
                    renderCart();
                    updateDashboard();
                    renderSavedReports();
                    updatePaymentSummary();
                    
                    alert('Semua data berhasil dihapus!');
                }
            }
        }

        // Customer Dropdown Functions
        function populateCustomerDropdown() {
            const select = document.getElementById('customer-select');
            select.innerHTML = '<option value="">Pelanggan Umum</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} - ${customer.phone}`;
                select.appendChild(option);
            });
        }

        function showAddCustomerFromTransaction() {
            showAddCustomerModal();
        }

        // Customer Management Functions
        function loadSampleCustomers() {
            customers = [
                {
                    id: 1,
                    name: 'Ahmad Wijaya',
                    phone: '081234567890',
                    email: 'ahmad.wijaya@email.com',
                    address: 'Jl. Merdeka No. 45, Jakarta Pusat',
                    type: 'member',
                    points: 150,
                    totalSpent: 850000,
                    lastPurchase: new Date('2024-11-28').toISOString(),
                    joinDate: new Date('2024-01-15').toISOString()
                },
                {
                    id: 2,
                    name: 'Siti Nurhaliza',
                    phone: '081234567891',
                    email: 'siti.nurhaliza@email.com',
                    address: 'Jl. Sudirman No. 123, Jakarta Selatan',
                    type: 'vip',
                    points: 320,
                    totalSpent: 1250000,
                    lastPurchase: new Date('2024-11-30').toISOString(),
                    joinDate: new Date('2023-12-10').toISOString()
                },
                {
                    id: 3,
                    name: 'Budi Santoso',
                    phone: '081234567892',
                    email: '',
                    address: 'Jl. Gatot Subroto No. 67, Jakarta Barat',
                    type: 'regular',
                    points: 25,
                    totalSpent: 180000,
                    lastPurchase: new Date('2024-11-25').toISOString(),
                    joinDate: new Date('2024-03-20').toISOString()
                },
                {
                    id: 4,
                    name: 'Dewi Lestari',
                    phone: '081234567893',
                    email: 'dewi.lestari@email.com',
                    address: 'Jl. Thamrin No. 89, Jakarta Pusat',
                    type: 'member',
                    points: 85,
                    totalSpent: 420000,
                    lastPurchase: new Date('2024-11-29').toISOString(),
                    joinDate: new Date('2024-02-14').toISOString()
                }
            ];
        }

        function updateCustomerStats() {
            const totalCustomers = customers.length;
            const activeMembers = customers.filter(c => c.type === 'member' || c.type === 'vip').length;
            const totalPoints = customers.reduce((sum, c) => sum + c.points, 0);
            
            // Calculate monthly transactions for customers
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthlyCustomerTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate.getMonth() === currentMonth && 
                       transactionDate.getFullYear() === currentYear &&
                       t.customerId;
            }).length;
            
            document.getElementById('total-customers').textContent = totalCustomers;
            document.getElementById('active-members').textContent = activeMembers;
            document.getElementById('total-points').textContent = totalPoints.toLocaleString();
            document.getElementById('monthly-customer-transactions').textContent = monthlyCustomerTransactions;
        }

        function renderCustomers() {
            const tbody = document.getElementById('customers-table');
            
            if (customers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">Belum ada data pelanggan</td></tr>';
                return;
            }
            
            tbody.innerHTML = customers.map(customer => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-4 px-6">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white font-bold mr-3">
                                ${customer.name.split(' ').map(n => n[0]).join('').substring(0, 2)}
                            </div>
                            <div>
                                <div class="font-semibold text-gray-800">${customer.name}</div>
                                <div class="text-sm text-gray-600">ID: ${customer.id}</div>
                            </div>
                        </div>
                    </td>
                    <td class="py-4 px-6">
                        <div class="text-gray-800">${customer.phone}</div>
                        ${customer.email ? `<div class="text-sm text-gray-600">${customer.email}</div>` : ''}
                    </td>
                    <td class="py-4 px-6">
                        <span class="bg-${getCustomerTypeColor(customer.type)}-100 text-${getCustomerTypeColor(customer.type)}-800 px-3 py-1 rounded-full text-sm font-semibold">
                            ${getCustomerTypeLabel(customer.type)}
                        </span>
                    </td>
                    <td class="py-4 px-6">
                        <div class="flex items-center">
                            <span class="text-lg font-bold text-purple-600">${customer.points}</span>
                            <span class="text-sm text-gray-500 ml-1">pts</span>
                        </div>
                    </td>
                    <td class="py-4 px-6 font-semibold text-success">${formatCurrency(customer.totalSpent)}</td>
                    <td class="py-4 px-6 text-gray-600">${new Date(customer.lastPurchase).toLocaleDateString('id-ID')}</td>
                    <td class="py-4 px-6">
                        <div class="flex space-x-2">
                            <button onclick="viewCustomerDetail(${customer.id})" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors">
                                üëÅÔ∏è Detail
                            </button>
                            <button onclick="editCustomer(${customer.id})" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors">
                                ‚úèÔ∏è Edit
                            </button>
                            <button onclick="deleteCustomer(${customer.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors">
                                üóëÔ∏è Hapus
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getCustomerTypeColor(type) {
            const colors = {
                'regular': 'gray',
                'member': 'blue',
                'vip': 'purple'
            };
            return colors[type] || 'gray';
        }

        function getCustomerTypeLabel(type) {
            const labels = {
                'regular': 'Regular',
                'member': 'Member',
                'vip': 'VIP'
            };
            return labels[type] || 'Regular';
        }

        function showAddCustomerModal() {
            document.getElementById('add-customer-modal').classList.remove('hidden');
        }

        function hideAddCustomerModal() {
            document.getElementById('add-customer-modal').classList.add('hidden');
            document.getElementById('add-customer-form').reset();
        }

        document.getElementById('add-customer-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newCustomer = {
                id: customers.length + 1,
                name: document.getElementById('new-customer-name').value,
                phone: document.getElementById('new-customer-phone').value,
                email: document.getElementById('new-customer-email').value,
                address: document.getElementById('new-customer-address').value,
                type: document.getElementById('new-customer-type').value,
                points: 0,
                totalSpent: 0,
                lastPurchase: null,
                joinDate: new Date().toISOString()
            };
            
            customers.push(newCustomer);
            renderCustomers();
            updateCustomerStats();
            populateCustomerDropdown();
            hideAddCustomerModal();
            
            alert('Pelanggan berhasil ditambahkan!');
        });

        function editCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer) {
                alert('Pelanggan tidak ditemukan!');
                return;
            }
            
            document.getElementById('edit-customer-id').value = customer.id;
            document.getElementById('edit-customer-name').value = customer.name;
            document.getElementById('edit-customer-phone').value = customer.phone;
            document.getElementById('edit-customer-email').value = customer.email || '';
            document.getElementById('edit-customer-address').value = customer.address || '';
            document.getElementById('edit-customer-type').value = customer.type;
            document.getElementById('edit-customer-points').value = customer.points;
            document.getElementById('edit-customer-total-spent').value = customer.totalSpent;
            
            document.getElementById('edit-customer-modal').classList.remove('hidden');
        }

        function hideEditCustomerModal() {
            document.getElementById('edit-customer-modal').classList.add('hidden');
            document.getElementById('edit-customer-form').reset();
        }

        // Initialize edit customer form handler
        if (!window.editCustomerFormInitialized) {
            document.getElementById('edit-customer-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const id = parseInt(document.getElementById('edit-customer-id').value);
                const customer = customers.find(c => c.id === id);
                
                if (customer) {
                    customer.name = document.getElementById('edit-customer-name').value;
                    customer.phone = document.getElementById('edit-customer-phone').value;
                    customer.email = document.getElementById('edit-customer-email').value;
                    customer.address = document.getElementById('edit-customer-address').value;
                    customer.type = document.getElementById('edit-customer-type').value;
                    customer.points = parseInt(document.getElementById('edit-customer-points').value) || 0;
                    
                    renderCustomers();
                    updateCustomerStats();
                    populateCustomerDropdown();
                    hideEditCustomerModal();
                    
                    alert('Data pelanggan berhasil diupdate!');
                } else {
                    alert('Error: Pelanggan tidak ditemukan!');
                }
            });
            window.editCustomerFormInitialized = true;
        }

        function viewCustomerDetail(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer) return;
            
            // Get customer transactions
            const customerTransactions = transactions.filter(t => t.customerId === id);
            
            const content = document.getElementById('customer-detail-content');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- Customer Info -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-3">Informasi Pelanggan</h4>
                        <div class="space-y-2 text-sm">
                            <div><span class="font-semibold">Nama:</span> ${customer.name}</div>
                            <div><span class="font-semibold">Telepon:</span> ${customer.phone}</div>
                            ${customer.email ? `<div><span class="font-semibold">Email:</span> ${customer.email}</div>` : ''}
                            <div><span class="font-semibold">Alamat:</span> ${customer.address || 'Tidak ada'}</div>
                            <div><span class="font-semibold">Tipe:</span> 
                                <span class="bg-${getCustomerTypeColor(customer.type)}-100 text-${getCustomerTypeColor(customer.type)}-800 px-2 py-1 rounded-full text-xs font-semibold">
                                    ${getCustomerTypeLabel(customer.type)}
                                </span>
                            </div>
                            <div><span class="font-semibold">Bergabung:</span> ${new Date(customer.joinDate).toLocaleDateString('id-ID')}</div>
                        </div>
                    </div>
                    
                    <!-- Customer Stats -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-3">Statistik Belanja</h4>
                        <div class="space-y-2 text-sm">
                            <div><span class="font-semibold">Total Belanja:</span> <span class="text-success font-bold">${formatCurrency(customer.totalSpent)}</span></div>
                            <div><span class="font-semibold">Poin Saat Ini:</span> <span class="text-purple-600 font-bold">${customer.points} pts</span></div>
                            <div><span class="font-semibold">Total Transaksi:</span> ${customerTransactions.length}</div>
                            ${customer.lastPurchase ? `<div><span class="font-semibold">Terakhir Belanja:</span> ${new Date(customer.lastPurchase).toLocaleDateString('id-ID')}</div>` : ''}
                            <div><span class="font-semibold">Rata-rata per Transaksi:</span> ${customerTransactions.length > 0 ? formatCurrency(customer.totalSpent / customerTransactions.length) : 'Rp 0'}</div>
                        </div>
                    </div>
                </div>
                
                <!-- Transaction History -->
                <div class="bg-white border rounded-lg">
                    <div class="p-4 border-b">
                        <h4 class="font-semibold text-gray-800">Riwayat Transaksi</h4>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Invoice</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Tanggal</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Items</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Total</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Poin</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${customerTransactions.length > 0 ? customerTransactions.map(t => `
                                    <tr class="border-b border-gray-100">
                                        <td class="py-3 px-4 font-semibold">${t.invoice}</td>
                                        <td class="py-3 px-4">${new Date(t.date).toLocaleDateString('id-ID')}</td>
                                        <td class="py-3 px-4">${t.items.length} items</td>
                                        <td class="py-3 px-4 font-semibold text-success">${formatCurrency(t.total)}</td>
                                        <td class="py-3 px-4 text-purple-600 font-semibold">+${Math.floor(t.total / 10000)} pts</td>
                                    </tr>
                                `).join('') : `
                                    <tr>
                                        <td colspan="5" class="text-center py-8 text-gray-500">Belum ada transaksi</td>
                                    </tr>
                                `}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button onclick="editCustomer(${customer.id}); hideCustomerDetailModal();" class="bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        ‚úèÔ∏è Edit Pelanggan
                    </button>
                    <button onclick="hideCustomerDetailModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                        ‚úÖ Tutup
                    </button>
                </div>
            `;
            
            document.getElementById('customer-detail-modal').classList.remove('hidden');
        }

        function hideCustomerDetailModal() {
            document.getElementById('customer-detail-modal').classList.add('hidden');
        }

        function deleteCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer) {
                alert('Pelanggan tidak ditemukan!');
                return;
            }
            
            // Check if customer has transactions
            const customerTransactions = transactions.filter(t => t.customerId === id);
            let confirmMessage = `Apakah Anda yakin ingin menghapus pelanggan "${customer.name}"?`;
            
            if (customerTransactions.length > 0) {
                confirmMessage += `\n\nPerhatian: Pelanggan ini memiliki ${customerTransactions.length} transaksi. Data transaksi akan tetap ada, tetapi akan menjadi "Pelanggan Umum".`;
            }
            
            if (confirm(confirmMessage)) {
                // Remove customer from array
                customers = customers.filter(c => c.id !== id);
                
                // Update transactions to remove customer reference
                transactions.forEach(t => {
                    if (t.customerId === id) {
                        t.customerId = null;
                        t.customerName = 'Pelanggan Umum';
                    }
                });
                
                renderCustomers();
                updateCustomerStats();
                populateCustomerDropdown();
                updateDashboard(); // Update dashboard to reflect transaction changes
                
                alert('Data pelanggan berhasil dihapus!');
            }
        }

        function filterCustomers() {
            const search = document.getElementById('customer-search').value.toLowerCase();
            const type = document.getElementById('customer-type-filter').value;
            
            let filtered = customers;
            
            if (search) {
                filtered = filtered.filter(c => 
                    c.name.toLowerCase().includes(search) || 
                    c.phone.includes(search)
                );
            }
            
            if (type) {
                filtered = filtered.filter(c => c.type === type);
            }
            
            // Update table with filtered results
            const tbody = document.getElementById('customers-table');
            tbody.innerHTML = filtered.map(customer => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-4 px-6">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white font-bold mr-3">
                                ${customer.name.split(' ').map(n => n[0]).join('').substring(0, 2)}
                            </div>
                            <div>
                                <div class="font-semibold text-gray-800">${customer.name}</div>
                                <div class="text-sm text-gray-600">ID: ${customer.id}</div>
                            </div>
                        </div>
                    </td>
                    <td class="py-4 px-6">
                        <div class="text-gray-800">${customer.phone}</div>
                        ${customer.email ? `<div class="text-sm text-gray-600">${customer.email}</div>` : ''}
                    </td>
                    <td class="py-4 px-6">
                        <span class="bg-${getCustomerTypeColor(customer.type)}-100 text-${getCustomerTypeColor(customer.type)}-800 px-3 py-1 rounded-full text-sm font-semibold">
                            ${getCustomerTypeLabel(customer.type)}
                        </span>
                    </td>
                    <td class="py-4 px-6">
                        <div class="flex items-center">
                            <span class="text-lg font-bold text-purple-600">${customer.points}</span>
                            <span class="text-sm text-gray-500 ml-1">pts</span>
                        </div>
                    </td>
                    <td class="py-4 px-6 font-semibold text-success">${formatCurrency(customer.totalSpent)}</td>
                    <td class="py-4 px-6 text-gray-600">${new Date(customer.lastPurchase).toLocaleDateString('id-ID')}</td>
                    <td class="py-4 px-6">
                        <div class="flex space-x-2">
                            <button onclick="viewCustomerDetail(${customer.id})" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors">
                                üëÅÔ∏è Detail
                            </button>
                            <button onclick="editCustomer(${customer.id})" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors">
                                ‚úèÔ∏è Edit
                            </button>
                            <button onclick="deleteCustomer(${customer.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors">
                                üóëÔ∏è Hapus
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function downloadCSVTemplate() {
            // Create comprehensive CSV template with BOM for proper UTF-8 encoding
            const csvContent = `\uFEFFBarcode,Nama Produk,Kategori,Harga Beli,Harga Jual,Stok
8997011553001,"Susu Ultra 1L",Dairy,9500,12000,45
8997011554002,"Indomie Goreng Original",Makanan,2800,3500,120
8997011555003,"Aqua 600ml",Minuman,2000,3000,80
8997011556004,"Chitato Sapi Panggang 68g",Snack,8500,11000,25
8997011557005,"Teh Botol Sosro 450ml",Minuman,3200,4500,60
8997011558006,"Roti Tawar Sari Roti",Makanan,4500,6000,30
8997011559007,"Kopi Kapal Api Bubuk",Minuman,12000,15000,15
8997011560008,"Mie Sedaap Goreng",Makanan,2900,3600,100
8997011561009,"Pocari Sweat 350ml",Minuman,4500,6000,40
8997011562010,"Keju Kraft Singles",Dairy,18000,22000,20`;
            
            try {
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'template_produk_pos.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert('Template CSV berhasil didownload!\n\nüìã PETUNJUK PENGGUNAAN:\n\n1Ô∏è‚É£ BUKA FILE:\n   ‚Ä¢ Excel: File ‚Üí Open ‚Üí Pilih template_produk_pos.csv\n   ‚Ä¢ Google Sheets: File ‚Üí Import ‚Üí Upload file\n\n2Ô∏è‚É£ EDIT DATA:\n   ‚Ä¢ Ganti data contoh dengan data produk Anda\n   ‚Ä¢ Jangan ubah nama kolom (baris pertama)\n   ‚Ä¢ Gunakan tanda koma (,) sebagai pemisah\n\n3Ô∏è‚É£ FORMAT KOLOM:\n   ‚Ä¢ Barcode: Angka unik (contoh: 8997011553001)\n   ‚Ä¢ Nama Produk: Teks dalam tanda kutip jika ada koma\n   ‚Ä¢ Kategori: Makanan/Minuman/Snack/Dairy\n   ‚Ä¢ Harga Beli: Angka tanpa titik/koma (contoh: 9500)\n   ‚Ä¢ Harga Jual: Angka tanpa titik/koma (contoh: 12000)\n   ‚Ä¢ Stok: Angka (contoh: 45)\n\n4Ô∏è‚É£ SIMPAN & IMPORT:\n   ‚Ä¢ Save as CSV (UTF-8) atau CSV (Comma delimited)\n   ‚Ä¢ Kembali ke sistem POS ‚Üí Import CSV\n\n‚ö†Ô∏è PENTING:\n   ‚Ä¢ Barcode harus unik (tidak boleh sama)\n   ‚Ä¢ Harga harus berupa angka\n   ‚Ä¢ Kategori harus sesuai pilihan yang tersedia');
            } catch (error) {
                console.error('Error downloading template:', error);
                
                // Enhanced fallback modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl shadow-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-montserrat font-bold text-gray-800">üìã Template CSV Produk</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
                        </div>
                        
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                            <div class="flex">
                                <div class="text-yellow-400 text-xl mr-3">‚ö†Ô∏è</div>
                                <div>
                                    <h4 class="text-yellow-800 font-semibold">Download Otomatis Gagal</h4>
                                    <p class="text-yellow-700 text-sm">Silakan copy template di bawah ini secara manual</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-semibold text-gray-800 mb-2">Template CSV:</h4>
                            <textarea class="w-full h-48 border border-gray-300 rounded-lg p-4 font-mono text-xs" readonly>${csvContent}</textarea>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                            <h4 class="font-semibold text-blue-800 mb-2">üìù Cara Penggunaan:</h4>
                            <ol class="text-sm text-blue-700 space-y-1">
                                <li>1. Copy template di atas</li>
                                <li>2. Buka Excel/Google Sheets</li>
                                <li>3. Paste template ke sheet baru</li>
                                <li>4. Edit data sesuai kebutuhan</li>
                                <li>5. Save as CSV (UTF-8)</li>
                                <li>6. Import ke sistem POS</li>
                            </ol>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="navigator.clipboard.writeText(\`${csvContent.replace(/`/g, '\\`')}\`).then(() => alert('‚úÖ Template berhasil dicopy ke clipboard!')).catch(() => alert('‚ùå Gagal copy, silakan copy manual dari textarea'))" class="flex-1 bg-primary text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                                üìã Copy ke Clipboard
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                                ‚úÖ Tutup
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        function importCSV() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv,.txt';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csvData = e.target.result;
                        const lines = csvData.split('\n');
                        const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
                        
                        // Validate headers - support both English and Indonesian headers
                        const headerMapping = {
                            'barcode': ['barcode'],
                            'name': ['name', 'nama produk', 'nama_produk'],
                            'category': ['category', 'kategori'],
                            'buyprice': ['buyprice', 'harga beli', 'harga_beli'],
                            'sellprice': ['sellprice', 'harga jual', 'harga_jual'],
                            'stock': ['stock', 'stok']
                        };
                        
                        const normalizedHeaders = {};
                        headers.forEach((header, index) => {
                            const cleanHeader = header.toLowerCase().replace(/\s+/g, ' ').trim();
                            for (const [key, variations] of Object.entries(headerMapping)) {
                                if (variations.includes(cleanHeader)) {
                                    normalizedHeaders[key] = index;
                                    break;
                                }
                            }
                        });
                        
                        const requiredHeaders = ['barcode', 'name', 'category', 'buyprice', 'sellprice', 'stock'];
                        const missingHeaders = requiredHeaders.filter(h => !(h in normalizedHeaders));
                        
                        if (missingHeaders.length > 0) {
                            alert(`Header CSV tidak lengkap. Header yang hilang: ${missingHeaders.join(', ')}\n\nGunakan template CSV yang disediakan.`);
                            return;
                        }
                        
                        let importedCount = 0;
                        let updatedCount = 0;
                        let errorCount = 0;
                        const errors = [];
                        
                        // Process data rows
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (!line) continue;
                            
                            const values = line.split(',').map(v => v.trim());
                            if (values.length !== headers.length) {
                                errors.push(`Baris ${i + 1}: Jumlah kolom tidak sesuai`);
                                errorCount++;
                                continue;
                            }
                            
                            try {
                                // Extract data using normalized header mapping
                                const rowData = {
                                    barcode: values[normalizedHeaders.barcode] || '',
                                    name: values[normalizedHeaders.name] || '',
                                    category: values[normalizedHeaders.category] || '',
                                    buyprice: values[normalizedHeaders.buyprice] || '0',
                                    sellprice: values[normalizedHeaders.sellprice] || '0',
                                    stock: values[normalizedHeaders.stock] || '0'
                                };
                                
                                // Validate required fields
                                if (!rowData.barcode || !rowData.name || !rowData.category) {
                                    errors.push(`Baris ${i + 1}: Data wajib tidak lengkap`);
                                    errorCount++;
                                    continue;
                                }
                                
                                // Check if product exists
                                const existingProduct = products.find(p => p.barcode === rowData.barcode);
                                
                                const productData = {
                                    barcode: rowData.barcode,
                                    name: rowData.name,
                                    category: rowData.category,
                                    buyPrice: parseInt(rowData.buyprice) || 0,
                                    sellPrice: parseInt(rowData.sellprice) || 0,
                                    stock: parseInt(rowData.stock) || 0
                                };
                                
                                if (existingProduct) {
                                    // Update existing product
                                    Object.assign(existingProduct, productData);
                                    updatedCount++;
                                } else {
                                    // Add new product
                                    productData.id = products.length + 1;
                                    products.push(productData);
                                    importedCount++;
                                }
                                
                            } catch (error) {
                                errors.push(`Baris ${i + 1}: ${error.message}`);
                                errorCount++;
                            }
                        }
                        
                        // Update displays
                        renderProducts();
                        renderQuickProducts();
                        updateDashboard();
                        checkLowStock();
                        
                        // Show results
                        let message = `Import CSV selesai!\n\n`;
                        message += `‚úÖ Produk baru: ${importedCount}\n`;
                        message += `üîÑ Produk diupdate: ${updatedCount}\n`;
                        if (errorCount > 0) {
                            message += `‚ùå Error: ${errorCount}\n\n`;
                            if (errors.length > 0) {
                                message += `Detail error:\n${errors.slice(0, 5).join('\n')}`;
                                if (errors.length > 5) {
                                    message += `\n... dan ${errors.length - 5} error lainnya`;
                                }
                            }
                        }
                        
                        alert(message);
                        
                    } catch (error) {
                        alert('Error membaca file CSV: ' + error.message + '\n\nPastikan file dalam format CSV yang benar.');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        // Backup System Functions
        let backupHistory = [];

        function initBackupSystem() {
            loadBackupHistory();
            updateBackupStats();
            renderBackupHistory();
        }

        function loadBackupHistory() {
            const saved = localStorage.getItem('pos_backup_history');
            if (saved) {
                backupHistory = JSON.parse(saved);
            }
        }

        function saveBackupHistory() {
            localStorage.setItem('pos_backup_history', JSON.stringify(backupHistory));
        }

        function updateBackupStats() {
            document.getElementById('backup-total-products').textContent = products.length;
            document.getElementById('backup-total-transactions').textContent = transactions.length;
            document.getElementById('backup-total-customers').textContent = customers.length;
            document.getElementById('backup-total-reports').textContent = reports.length;
        }

        function createFullBackup() {
            try {
                // Create comprehensive Excel backup with multiple sheets
                let csvContent = '';
                
                // Store Information Sheet
                csvContent += `BACKUP LENGKAP SISTEM POS\n`;
                csvContent += `Toko: ${storeSettings.name}\n`;
                csvContent += `Alamat: ${storeSettings.address}\n`;
                csvContent += `Telepon: ${storeSettings.phone}\n`;
                csvContent += `Email: ${storeSettings.email}\n`;
                csvContent += `Dibuat: ${new Date().toLocaleString('id-ID')}\n`;
                csvContent += `Versi: 1.0\n\n`;
                
                // Products Sheet
                csvContent += `DAFTAR PRODUK\n`;
                csvContent += `ID,Barcode,Nama Produk,Kategori,Harga Beli,Harga Jual,Stok\n`;
                products.forEach(p => {
                    csvContent += `${p.id},${p.barcode},"${p.name}",${p.category},${p.buyPrice},${p.sellPrice},${p.stock}\n`;
                });
                csvContent += `\nTotal Produk: ${products.length}\n\n`;
                
                // Transactions Sheet
                csvContent += `DAFTAR TRANSAKSI\n`;
                csvContent += `ID,Invoice,Tanggal,Waktu,Pelanggan,Items,Subtotal,PPN,Total,Modal,Profit,Margin,Pembayaran,Cash,Kembalian\n`;
                transactions.forEach(t => {
                    const date = new Date(t.date);
                    const margin = t.total > 0 ? ((t.totalProfit || 0) / t.total * 100).toFixed(1) : '0';
                    csvContent += `${t.id},"${t.invoice}",${date.toLocaleDateString('id-ID')},${date.toLocaleTimeString('id-ID')},"${t.customerName || 'Pelanggan Umum'}",${t.items.length},${t.subtotal || 0},${t.tax || 0},${t.total},${t.totalCost || 0},${t.totalProfit || 0},${margin}%,${t.paymentMethod},${t.cashAmount || 0},${t.change || 0}\n`;
                });
                csvContent += `\nTotal Transaksi: ${transactions.length}\n\n`;
                
                // Transaction Items Detail
                csvContent += `DETAIL ITEM TRANSAKSI\n`;
                csvContent += `Invoice,Pelanggan,Produk ID,Nama Produk,Harga,Qty,Subtotal,Modal,Profit\n`;
                transactions.forEach(t => {
                    t.items.forEach(item => {
                        csvContent += `"${t.invoice}","${t.customerName || 'Pelanggan Umum'}",${item.productId},"${item.name}",${item.price},${item.quantity},${item.price * item.quantity},${item.cost || 0},${item.profit || 0}\n`;
                    });
                });
                csvContent += `\n`;
                
                // Customers Sheet
                csvContent += `DAFTAR PELANGGAN\n`;
                csvContent += `ID,Nama,Telepon,Email,Alamat,Tipe,Poin,Total Belanja,Terakhir Belanja,Bergabung\n`;
                customers.forEach(c => {
                    csvContent += `${c.id},"${c.name}",${c.phone},"${c.email || ''}","${c.address || ''}",${c.type},${c.points},${c.totalSpent},${c.lastPurchase ? new Date(c.lastPurchase).toLocaleDateString('id-ID') : ''},${new Date(c.joinDate).toLocaleDateString('id-ID')}\n`;
                });
                csvContent += `\nTotal Pelanggan: ${customers.length}\n\n`;
                
                // Reports Sheet
                csvContent += `LAPORAN TERSIMPAN\n`;
                csvContent += `ID,Nama Laporan,Periode,Total Penjualan,Total Modal,Total Profit,Margin,Transaksi,Dibuat\n`;
                reports.forEach(r => {
                    csvContent += `"${r.id}","${r.name}","${r.period}",${r.totalSales},${r.totalCost || 0},${r.totalProfit || 0},${(r.profitMargin || 0).toFixed(1)}%,${r.totalTransactions},${new Date(r.createdAt).toLocaleDateString('id-ID')}\n`;
                });
                csvContent += `\nTotal Laporan: ${reports.length}\n\n`;
                
                // Summary Statistics
                csvContent += `RINGKASAN STATISTIK\n`;
                csvContent += `Kategori,Jumlah\n`;
                csvContent += `Total Produk,${products.length}\n`;
                csvContent += `Total Transaksi,${transactions.length}\n`;
                csvContent += `Total Pelanggan,${customers.length}\n`;
                csvContent += `Total Laporan,${reports.length}\n`;
                csvContent += `Total Penjualan,${formatCurrency(transactions.reduce((sum, t) => sum + t.total, 0))}\n`;
                csvContent += `Total Profit,${formatCurrency(transactions.reduce((sum, t) => sum + (t.totalProfit || 0), 0))}\n`;
                
                const dataSize = csvContent.length;
                const fileName = `POS_Backup_Lengkap_${new Date().toISOString().slice(0, 19).replace(/[:-]/g, '')}.csv`;
                
                // Download Excel file
                downloadExcelBackup(csvContent, fileName);
                
                // Add to backup history
                const historyEntry = {
                    id: 'backup_' + Date.now(),
                    date: new Date().toISOString(),
                    type: 'Backup Lengkap Excel',
                    size: formatBytes(dataSize),
                    status: 'Berhasil',
                    fileName: fileName,
                    itemCount: {
                        products: products.length,
                        transactions: transactions.length,
                        customers: customers.length,
                        reports: reports.length
                    }
                };
                
                backupHistory.unshift(historyEntry);
                if (backupHistory.length > 10) backupHistory = backupHistory.slice(0, 10);
                saveBackupHistory();
                renderBackupHistory();
                
                alert(`‚úÖ Backup lengkap Excel berhasil dibuat!\n\nüìÅ File: ${fileName}\nüìä Data: ${products.length} produk, ${transactions.length} transaksi, ${customers.length} pelanggan\nüíæ Ukuran: ${formatBytes(dataSize)}\n\nüí° File dapat dibuka dengan:\n‚Ä¢ Microsoft Excel\n‚Ä¢ Google Sheets\n‚Ä¢ LibreOffice Calc\n\nüîí Simpan file backup di tempat yang aman!`);
                
            } catch (error) {
                console.error('Backup error:', error);
                alert('‚ùå Gagal membuat backup: ' + error.message);
            }
        }

        function createQuickBackup() {
            try {
                // Create quick Excel backup with essential data
                let csvContent = '';
                const recentTransactions = transactions.slice(-100); // Last 100 transactions
                
                // Store Information
                csvContent += `BACKUP CEPAT SISTEM POS\n`;
                csvContent += `Toko: ${storeSettings.name}\n`;
                csvContent += `Alamat: ${storeSettings.address}\n`;
                csvContent += `Telepon: ${storeSettings.phone}\n`;
                csvContent += `Dibuat: ${new Date().toLocaleString('id-ID')}\n`;
                csvContent += `Tipe: Backup Cepat (Produk + 100 Transaksi Terakhir)\n\n`;
                
                // Products Sheet
                csvContent += `DAFTAR PRODUK\n`;
                csvContent += `ID,Barcode,Nama Produk,Kategori,Harga Beli,Harga Jual,Stok\n`;
                products.forEach(p => {
                    csvContent += `${p.id},${p.barcode},"${p.name}",${p.category},${p.buyPrice},${p.sellPrice},${p.stock}\n`;
                });
                csvContent += `\nTotal Produk: ${products.length}\n\n`;
                
                // Recent Transactions
                csvContent += `TRANSAKSI TERAKHIR (100 TERBARU)\n`;
                csvContent += `ID,Invoice,Tanggal,Waktu,Pelanggan,Items,Total,Modal,Profit,Margin,Pembayaran\n`;
                recentTransactions.forEach(t => {
                    const date = new Date(t.date);
                    const margin = t.total > 0 ? ((t.totalProfit || 0) / t.total * 100).toFixed(1) : '0';
                    csvContent += `${t.id},"${t.invoice}",${date.toLocaleDateString('id-ID')},${date.toLocaleTimeString('id-ID')},"${t.customerName || 'Pelanggan Umum'}",${t.items.length},${t.total},${t.totalCost || 0},${t.totalProfit || 0},${margin}%,${t.paymentMethod}\n`;
                });
                csvContent += `\nTotal Transaksi: ${recentTransactions.length} (dari ${transactions.length} total)\n\n`;
                
                // Quick Summary
                csvContent += `RINGKASAN CEPAT\n`;
                csvContent += `Kategori,Jumlah\n`;
                csvContent += `Total Produk,${products.length}\n`;
                csvContent += `Transaksi Terakhir,${recentTransactions.length}\n`;
                csvContent += `Total Semua Transaksi,${transactions.length}\n`;
                csvContent += `Penjualan Terakhir,${formatCurrency(recentTransactions.reduce((sum, t) => sum + t.total, 0))}\n`;
                csvContent += `Profit Terakhir,${formatCurrency(recentTransactions.reduce((sum, t) => sum + (t.totalProfit || 0), 0))}\n`;
                
                const dataSize = csvContent.length;
                const fileName = `POS_Backup_Cepat_${new Date().toISOString().slice(0, 19).replace(/[:-]/g, '')}.csv`;
                
                // Download Excel file
                downloadExcelBackup(csvContent, fileName);
                
                // Add to backup history
                const historyEntry = {
                    id: 'backup_' + Date.now(),
                    date: new Date().toISOString(),
                    type: 'Backup Cepat Excel',
                    size: formatBytes(dataSize),
                    status: 'Berhasil',
                    fileName: fileName,
                    itemCount: {
                        products: products.length,
                        transactions: recentTransactions.length,
                        customers: 0,
                        reports: 0
                    }
                };
                
                backupHistory.unshift(historyEntry);
                if (backupHistory.length > 10) backupHistory = backupHistory.slice(0, 10);
                saveBackupHistory();
                renderBackupHistory();
                
                alert(`‚ö° Backup cepat Excel berhasil dibuat!\n\nüìÅ File: ${fileName}\nüìä Data: ${products.length} produk, ${recentTransactions.length} transaksi terakhir\nüíæ Ukuran: ${formatBytes(dataSize)}\n\nüí° File dapat dibuka dengan Excel, Google Sheets, atau LibreOffice Calc\n\nüöÄ Backup cepat cocok untuk backup harian!`);
                
            } catch (error) {
                console.error('Quick backup error:', error);
                alert('‚ùå Gagal membuat backup cepat: ' + error.message);
            }
        }

        function downloadBackupFile(data, fileName) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function downloadExcelBackup(csvContent, fileName) {
            // Add BOM for proper UTF-8 encoding in Excel
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { 
                type: 'text/csv;charset=utf-8;' 
            });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function restoreFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!confirm('‚ö†Ô∏è PERINGATAN RESTORE DATA\n\nRestore akan mengganti SEMUA data yang ada saat ini dengan data dari file backup.\n\nPastikan Anda telah membuat backup data saat ini sebelum melanjutkan.\n\nLanjutkan restore?')) {
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        // Validate backup file
                        if (!backupData.version || !backupData.data) {
                            throw new Error('Format file backup tidak valid');
                        }
                        
                        if (!backupData.data.products || !Array.isArray(backupData.data.products)) {
                            throw new Error('Data produk tidak valid dalam backup');
                        }
                        
                        // Show restore confirmation with details
                        const confirmMessage = `üìã KONFIRMASI RESTORE\n\n` +
                            `üìÅ File: ${file.name}\n` +
                            `üìÖ Dibuat: ${new Date(backupData.timestamp).toLocaleString('id-ID')}\n` +
                            `üìä Tipe: ${backupData.type === 'full' ? 'Backup Lengkap' : 'Backup Cepat'}\n\n` +
                            `DATA YANG AKAN DI-RESTORE:\n` +
                            `‚Ä¢ Produk: ${backupData.data.products?.length || 0}\n` +
                            `‚Ä¢ Transaksi: ${backupData.data.transactions?.length || 0}\n` +
                            `‚Ä¢ Pelanggan: ${backupData.data.customers?.length || 0}\n` +
                            `‚Ä¢ Laporan: ${backupData.data.reports?.length || 0}\n\n` +
                            `‚ö†Ô∏è SEMUA DATA SAAT INI AKAN DIGANTI!\n\n` +
                            `Lanjutkan restore?`;
                        
                        if (!confirm(confirmMessage)) {
                            return;
                        }
                        
                        // Perform restore
                        if (backupData.data.products) products = backupData.data.products;
                        if (backupData.data.transactions) transactions = backupData.data.transactions;
                        if (backupData.data.customers) customers = backupData.data.customers;
                        if (backupData.data.reports) reports = backupData.data.reports;
                        if (backupData.data.storeSettings) {
                            storeSettings = backupData.data.storeSettings;
                            updateStoreSettingsForm();
                            saveStoreSettings();
                        }
                        if (backupData.data.invoiceCounter) invoiceCounter = backupData.data.invoiceCounter;
                        
                        // Update all displays
                        renderProducts();
                        renderQuickProducts();
                        renderCustomers();
                        updateCustomerStats();
                        updateDashboard();
                        renderSavedReports();
                        populateCustomerDropdown();
                        updateBackupStats();
                        checkLowStock();
                        
                        // Add to backup history
                        const historyEntry = {
                            id: 'restore_' + Date.now(),
                            date: new Date().toISOString(),
                            type: 'Restore Data',
                            size: formatBytes(JSON.stringify(backupData).length),
                            status: 'Berhasil',
                            fileName: file.name,
                            itemCount: {
                                products: backupData.data.products?.length || 0,
                                transactions: backupData.data.transactions?.length || 0,
                                customers: backupData.data.customers?.length || 0,
                                reports: backupData.data.reports?.length || 0
                            }
                        };
                        
                        backupHistory.unshift(historyEntry);
                        if (backupHistory.length > 10) backupHistory = backupHistory.slice(0, 10);
                        saveBackupHistory();
                        renderBackupHistory();
                        
                        alert(`‚úÖ Restore berhasil!\n\nüìä Data yang di-restore:\n‚Ä¢ ${backupData.data.products?.length || 0} produk\n‚Ä¢ ${backupData.data.transactions?.length || 0} transaksi\n‚Ä¢ ${backupData.data.customers?.length || 0} pelanggan\n‚Ä¢ ${backupData.data.reports?.length || 0} laporan\n\nüîÑ Semua tampilan telah diperbarui.`);
                        
                    } catch (error) {
                        console.error('Restore error:', error);
                        alert(`‚ùå Gagal restore data: ${error.message}\n\nPastikan file backup valid dan tidak rusak.`);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function renderBackupHistory() {
            const tbody = document.getElementById('backup-history');
            
            if (backupHistory.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">Belum ada riwayat backup</td></tr>';
                return;
            }
            
            tbody.innerHTML = backupHistory.map(entry => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4">
                        <div class="font-semibold text-gray-800">${new Date(entry.date).toLocaleDateString('id-ID')}</div>
                        <div class="text-sm text-gray-600">${new Date(entry.date).toLocaleTimeString('id-ID')}</div>
                    </td>
                    <td class="py-3 px-4">
                        <span class="bg-${entry.type.includes('Restore') ? 'orange' : entry.type.includes('Lengkap') ? 'blue' : 'green'}-100 text-${entry.type.includes('Restore') ? 'orange' : entry.type.includes('Lengkap') ? 'blue' : 'green'}-800 px-2 py-1 rounded-full text-xs font-semibold">
                            ${entry.type}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <div class="font-semibold">${entry.size}</div>
                        <div class="text-xs text-gray-600">
                            ${entry.itemCount.products}P, ${entry.itemCount.transactions}T, ${entry.itemCount.customers}C
                        </div>
                    </td>
                    <td class="py-3 px-4">
                        <span class="bg-${entry.status === 'Berhasil' ? 'green' : 'red'}-100 text-${entry.status === 'Berhasil' ? 'green' : 'red'}-800 px-2 py-1 rounded-full text-xs font-semibold">
                            ${entry.status}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <button onclick="viewBackupDetail('${entry.id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors">
                            üëÅÔ∏è Detail
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function viewBackupDetail(entryId) {
            const entry = backupHistory.find(e => e.id === entryId);
            if (!entry) return;
            
            const detail = `üìã DETAIL BACKUP/RESTORE\n\n` +
                `üìÖ Tanggal: ${new Date(entry.date).toLocaleString('id-ID')}\n` +
                `üìÅ File: ${entry.fileName}\n` +
                `üìä Tipe: ${entry.type}\n` +
                `üíæ Ukuran: ${entry.size}\n` +
                `‚úÖ Status: ${entry.status}\n\n` +
                `DATA:\n` +
                `‚Ä¢ Produk: ${entry.itemCount.products}\n` +
                `‚Ä¢ Transaksi: ${entry.itemCount.transactions}\n` +
                `‚Ä¢ Pelanggan: ${entry.itemCount.customers}\n` +
                `‚Ä¢ Laporan: ${entry.itemCount.reports}`;
            
            alert(detail);
        }

        function clearBackupHistory() {
            if (backupHistory.length === 0) {
                alert('Tidak ada riwayat backup untuk dihapus.');
                return;
            }
            
            if (confirm('Hapus semua riwayat backup?\n\nCatatan: Ini hanya menghapus riwayat, bukan file backup yang sudah didownload.')) {
                backupHistory = [];
                saveBackupHistory();
                renderBackupHistory();
                alert('Riwayat backup berhasil dihapus!');
            }
        }

        function showRestoreHistory() {
            const restoreEntries = backupHistory.filter(entry => entry.type.includes('Restore'));
            
            if (restoreEntries.length === 0) {
                alert('Belum ada riwayat restore data.');
                return;
            }
            
            const historyText = restoreEntries.map(entry => 
                `üìÖ ${new Date(entry.date).toLocaleString('id-ID')}\n` +
                `üìÅ ${entry.fileName}\n` +
                `üìä ${entry.itemCount.products}P, ${entry.itemCount.transactions}T, ${entry.itemCount.customers}C\n`
            ).join('\n');
            
            alert(`üìú RIWAYAT RESTORE\n\n${historyText}`);
        }

        // Export Functions
        function exportProducts() {
            let csvContent = `EXPORT PRODUK - ${storeSettings.name}\n`;
            csvContent += `Tanggal Export: ${new Date().toLocaleString('id-ID')}\n`;
            csvContent += `Total Produk: ${products.length}\n\n`;
            
            csvContent += `ID,Barcode,Nama Produk,Kategori,Harga Beli,Harga Jual,Stok,Margin,Status Stok\n`;
            products.forEach(p => {
                const margin = p.sellPrice > 0 ? (((p.sellPrice - p.buyPrice) / p.sellPrice) * 100).toFixed(1) : '0';
                const stockStatus = p.stock <= 10 ? 'Rendah' : p.stock <= 50 ? 'Normal' : 'Tinggi';
                csvContent += `${p.id},${p.barcode},"${p.name}",${p.category},${p.buyPrice},${p.sellPrice},${p.stock},${margin}%,${stockStatus}\n`;
            });
            
            csvContent += `\nRINGKASAN PRODUK\n`;
            csvContent += `Kategori,Jumlah\n`;
            const categoryCount = {};
            products.forEach(p => {
                categoryCount[p.category] = (categoryCount[p.category] || 0) + 1;
            });
            Object.entries(categoryCount).forEach(([category, count]) => {
                csvContent += `${category},${count}\n`;
            });
            
            downloadExcelBackup(csvContent, `Export_Produk_${new Date().toISOString().slice(0, 10)}.csv`);
            alert(`üì¶ Export produk Excel berhasil!\n\nüìä ${products.length} produk telah di-export\nüí° File dapat dibuka dengan Excel, Google Sheets, atau LibreOffice Calc`);
        }

        function exportTransactions() {
            if (transactions.length === 0) {
                alert('Tidak ada data transaksi untuk di-export.');
                return;
            }
            
            let csvContent = `EXPORT TRANSAKSI - ${storeSettings.name}\n`;
            csvContent += `Tanggal Export: ${new Date().toLocaleString('id-ID')}\n`;
            csvContent += `Total Transaksi: ${transactions.length}\n`;
            csvContent += `Periode: ${transactions.length > 0 ? new Date(transactions[0].date).toLocaleDateString('id-ID') : ''} - ${transactions.length > 0 ? new Date(transactions[transactions.length - 1].date).toLocaleDateString('id-ID') : ''}\n\n`;
            
            csvContent += `ID,Invoice,Tanggal,Waktu,Pelanggan,Items,Subtotal,PPN,Total,Modal,Profit,Margin,Pembayaran,Cash,Kembalian\n`;
            transactions.forEach(t => {
                const date = new Date(t.date);
                const margin = t.total > 0 ? ((t.totalProfit || 0) / t.total * 100).toFixed(1) : '0';
                csvContent += `${t.id},"${t.invoice}",${date.toLocaleDateString('id-ID')},${date.toLocaleTimeString('id-ID')},"${t.customerName || 'Pelanggan Umum'}",${t.items.length},${t.subtotal || 0},${t.tax || 0},${t.total},${t.totalCost || 0},${t.totalProfit || 0},${margin}%,${t.paymentMethod},${t.cashAmount || 0},${t.change || 0}\n`;
            });
            
            csvContent += `\nRINGKASAN TRANSAKSI\n`;
            csvContent += `Metrik,Nilai\n`;
            csvContent += `Total Penjualan,${formatCurrency(transactions.reduce((sum, t) => sum + t.total, 0))}\n`;
            csvContent += `Total Modal,${formatCurrency(transactions.reduce((sum, t) => sum + (t.totalCost || 0), 0))}\n`;
            csvContent += `Total Profit,${formatCurrency(transactions.reduce((sum, t) => sum + (t.totalProfit || 0), 0))}\n`;
            csvContent += `Rata-rata per Transaksi,${formatCurrency(transactions.reduce((sum, t) => sum + t.total, 0) / transactions.length)}\n`;
            
            downloadExcelBackup(csvContent, `Export_Transaksi_${new Date().toISOString().slice(0, 10)}.csv`);
            alert(`üõí Export transaksi Excel berhasil!\n\nüìä ${transactions.length} transaksi telah di-export\nüí° File dapat dibuka dengan Excel, Google Sheets, atau LibreOffice Calc`);
        }

        function exportCustomers() {
            if (customers.length === 0) {
                alert('Tidak ada data pelanggan untuk di-export.');
                return;
            }
            
            let csvContent = `EXPORT PELANGGAN - ${storeSettings.name}\n`;
            csvContent += `Tanggal Export: ${new Date().toLocaleString('id-ID')}\n`;
            csvContent += `Total Pelanggan: ${customers.length}\n\n`;
            
            csvContent += `ID,Nama,Telepon,Email,Alamat,Tipe,Poin,Total Belanja,Transaksi,Terakhir Belanja,Bergabung,Status\n`;
            customers.forEach(c => {
                const customerTransactions = transactions.filter(t => t.customerId === c.id);
                const status = c.lastPurchase && new Date() - new Date(c.lastPurchase) < 30 * 24 * 60 * 60 * 1000 ? 'Aktif' : 'Tidak Aktif';
                csvContent += `${c.id},"${c.name}",${c.phone},"${c.email || ''}","${c.address || ''}",${c.type},${c.points},${c.totalSpent},${customerTransactions.length},${c.lastPurchase ? new Date(c.lastPurchase).toLocaleDateString('id-ID') : 'Belum Pernah'},${new Date(c.joinDate).toLocaleDateString('id-ID')},${status}\n`;
            });
            
            csvContent += `\nRINGKASAN PELANGGAN\n`;
            csvContent += `Tipe,Jumlah\n`;
            const typeCount = {};
            customers.forEach(c => {
                typeCount[c.type] = (typeCount[c.type] || 0) + 1;
            });
            Object.entries(typeCount).forEach(([type, count]) => {
                csvContent += `${type},${count}\n`;
            });
            
            downloadExcelBackup(csvContent, `Export_Pelanggan_${new Date().toISOString().slice(0, 10)}.csv`);
            alert(`üë• Export pelanggan Excel berhasil!\n\nüìä ${customers.length} pelanggan telah di-export\nüí° File dapat dibuka dengan Excel, Google Sheets, atau LibreOffice Calc`);
        }

        function exportReports() {
            if (reports.length === 0) {
                alert('Tidak ada laporan tersimpan untuk di-export.');
                return;
            }
            
            let csvContent = `EXPORT LAPORAN TERSIMPAN - ${storeSettings.name}\n`;
            csvContent += `Tanggal Export: ${new Date().toLocaleString('id-ID')}\n`;
            csvContent += `Total Laporan: ${reports.length}\n\n`;
            
            csvContent += `ID,Nama Laporan,Periode,Total Penjualan,Total Modal,Total Profit,Margin,Transaksi,Dibuat,Deskripsi\n`;
            reports.forEach(r => {
                csvContent += `"${r.id}","${r.name}","${r.period}",${r.totalSales},${r.totalCost || 0},${r.totalProfit || 0},${(r.profitMargin || 0).toFixed(1)}%,${r.totalTransactions},${new Date(r.createdAt).toLocaleDateString('id-ID')},"${r.description || ''}"\n`;
            });
            
            csvContent += `\nRINGKASAN LAPORAN\n`;
            csvContent += `Metrik,Nilai\n`;
            csvContent += `Total Penjualan Semua Laporan,${formatCurrency(reports.reduce((sum, r) => sum + (r.totalSales || 0), 0))}\n`;
            csvContent += `Total Profit Semua Laporan,${formatCurrency(reports.reduce((sum, r) => sum + (r.totalProfit || 0), 0))}\n`;
            csvContent += `Rata-rata Margin,${(reports.reduce((sum, r) => sum + (r.profitMargin || 0), 0) / reports.length).toFixed(1)}%\n`;
            
            downloadExcelBackup(csvContent, `Export_Laporan_${new Date().toISOString().slice(0, 10)}.csv`);
            alert(`üìä Export laporan Excel berhasil!\n\nüìã ${reports.length} laporan telah di-export\nüí° File dapat dibuka dengan Excel, Google Sheets, atau LibreOffice Calc`);
        }

        function downloadCSVFile(content, fileName) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Utility Functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'969ef23425b2ce0a',t:'MTc1NDMxOTg1NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
